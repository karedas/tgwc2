{"version":3,"sources":["webpack://Tg.[name]/webpack/universalModuleDefinition","webpack://Tg.[name]/webpack/bootstrap","webpack://Tg.[name]/../.modernizrrc.js","webpack://Tg.[name]/./js/app.js","webpack://Tg.[name]/./js/modules/client.js","webpack://Tg.[name]/./js/modules/mapDrawer.js","webpack://Tg.[name]/./js/modules/preloader.js","webpack://Tg.[name]/ws (ignored)","webpack://Tg.[name]/external \"jQuery\""],"names":["window","hadGlobal","oldGlobal","Modernizr","document","undefined","tests","ModernizrProto","_version","_config","_q","on","test","cb","self","setTimeout","addTest","name","fn","options","push","addAsyncTest","prototype","classes","is","obj","type","testRunner","featureNames","feature","aliasIdx","result","nameIdx","featureName","featureNameSplit","featureIdx","hasOwnProperty","toLowerCase","aliases","length","split","Boolean","join","docElement","documentElement","isSVG","nodeName","setClasses","className","classPrefix","baseVal","enableJSClass","reJS","RegExp","replace","enableClasses","mod","localStorage","setItem","removeItem","e","sessionStorage","i","module","exports","$","ajaxSetup","cache","onReady","client","TgClient","init","ready","TgGui","ws_server_addr","socket_io_resource","media_server_addr","ws_prefix","images_path","sounds_path","socketListener","cookies","prefix","expires","isConnected","socket","netdata","inGame","isGod","godInvLev","connectionInfo","loginName","loginPass","error","client_state","client_options","alpha_approved","shortcuts","login","interface","dashboard","details","compact","in_editor","cursor_on_map","max_history_length","cmd_history_pos","cmd_history","dir_north","dir_east","dir_south","dir_west","dir_up","dir_down","dir_names","dir_status","shortcuts_map","cmd_prefix","last_room_desc","exp_grp_list","hlttxtcol","let","txt","client_update","interfaceData","info","stato","last","inventory","version","needed","equipment","room","scrollbar","output","debug","_","cookie_consent","LoadStorage","showCookieLawDisclaimer","removeCookieLawDisclaimer","startClient","initSessionData","connectToServer","then","resolve","reject","initLoginPanel","console","log","Promise","destroy","io","connect","networkActivityMessage","setDisconnect","data","indexOf","end","rep","parseJSON","slice","msg","sendOOB","itime","when","toString","performLogin","clientPreloader","Preloader","AssetsList","loginNetworkActivityMessage","hideLoginPanel","loadInterface","completeHandshake","handleServerData","connectionError","getLoginReplyMessage","loginError","off","bind","setHandshaked","len","preparseText","substr","showOutput","parseForDisplay","err","clearUpdate","show","SaveStorage","magnificPopup","close","openPopup","remove","saved_state","Cookies","getJSON","localstorage","set","extend","Date","getTime","saved_options","what","JSON","parse","get","value","stringify","path","hide","css","focus","preventDefault","val","pass","mode","handleLoginData","emit","sendToServer","text","status","attr","historyPush","disconnect","pos","sky","sky_parse","charAt","setSky","doors","doors_parse","setDoors","audio","audio_parse","lastIndexOf","playAudio","status_parse","setStatus","update","update_parse","image","image_parse","showImage","processCommands","closeEditor","options_parse","openEditor","map","map_parse","MAP_OBJECT","updateMap","b","b_parse","cmd","cmd_parse","p","page_parse","page_html","title","t","gtable_parse","inv","inv_parse","dtls","dtls_parse","renderDetails","dir","renderDetailsInText","eq","eq_parse","wk","wk_parse","skinfo","skinfo_parse","info_parse","setDataInterface","s","rcommand_parse","handleRefresh","pauseOn","clearOutput","line","link","link_parse","mob","mob_parse","desc_parse","renderMob","obj_parse","renderObject","icon","icon_parse","renderIcon","parseInt","replaceColors","r","isModalOpen","condprc","count","mrn","desc","addclass","decoratedDescription","moveprc","wgt","countStr","renderMinidetails","Math","floor","html","conv","removeClass","addClass","width","food","drink","maxchars","textarea","one","abortEdit","saveEdit","text_max","keyup","text_length","text_remaining","focusInput","maxLinelen","l","remText","currline","slicepos","cont","imgsrc","currimgsrc","tilenum","tc","tileCoords","posx","posy","cnttype","cntmrn","tileBgPos","skypos","godinvlev","d","hprc","mprc","hcolor","prcLowTxt","mcolor","limitPrc","st","updatePlayerStatus","res","capFirstLetter","renderDetailsInner","container","empty","append","ver","numberClassList","action","base","formatText","repeatlast","equip","objcont","perscont","renderDetailsList","num","cont_type","cont_num","style","list","sort","a","n","is_group","opened","tradd","tdadd","cntnum","mvprc","sz","equip_positions_by_num","m","string","toUpperCase","page","parags","each","prc","values","save_history","cmds","parseInput","input","inputs","subs","substShort","concat","args","shortcut_key","shift","shortcut_num","shortcut_cmd","isNaN","arg","rx","updateInput","login_reply_message","outputHeigt","height","scrollTop","genericEvents","mainNavBarInit","tooltipInit","inputInit","outputInit","keyboardMapInit","mapInit","doorsInit","buttonsEventInit","main","initSearchWidget","url","getValue","match","enabled","onClickEvent","element","alert","theme","easyAutocomplete","tooltip","selector","delay","addScrollBar","mouseenter","mouseleave","event","metaKey","ctrlKey","altKey","which","goDir","target","sendInput","shiftKey","historyUp","historyDown","Map","prepareCanvas","closeLockDoor","cmdButtons","id","disconnectFromServer","idx","bdata","button","slideToggle","animate","toggleClass","inputVal","content_ref","content","MP_type","MP_close_button","MP_closeOnBgClick","MP_src","MP_callbacks","open","showCloseBtn","closeOnBgClick","preloader","items","src","mainClass","callbacks","instance","contentContainer","draggabilly","handle","containment","PerfectScrollbar","wheelPropagation","isOpen","MapDrawer","maxmapwidth","maxmapheight","maptilewidth","maptileheight","maplight","mapidprefix","MAPCTX","maptileimg","mapshadowimg","MAPRAIN","MAPSNOW","mapfogimg","cursoronmap","layermap","Array","y","imagesPath","getContext","Image","makeSnow","mapshadowtile","drawCanvasMap","xoff","yoff","xlim","ylim","light","canvaswidth","canvasheight","radius","offset","clearRect","x","tpos","drawImage","clipx","clipy","swidth","sheight","snowCanvasId","framerate","flakeNumberModifier","fallSpeedModifier","canvas","getElementById","context","numFlakes","min","flakes","TWO_PI","PI","radHeight","flake","createElement","flakeContext","fillStyle","beginPath","arc","fill","getRandomFlake","setInterval","tick","posX","imageData","sin","yMod","size","waveSize","globalAlpha","range","max","start","random","w","innerWidth","h","innerHeight","strokeStyle","lineWidth","lineCap","maxParts","xs","ys","particles","draw","c","moveTo","lineTo","stroke","move","assets","basepath","assetsList","loadAssets","done","images","body","percentage","stepSize","loadedimages","postaction","imageloadpost","find","onload","onerror","f"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,CAAC;AACD,O;ACVA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAQ,oBAAoB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAiB,4BAA4B;AAC7C;AACA;AACA,0BAAkB,2BAA2B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAgB,uBAAuB;AACvC;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACtJA,CAAC,CAAC,UAASA,MAAT,EAAgB;AAAC,MAAIC,YAAU,eAAeD,MAA7B,CAAoC,IAAIE,YAAUF,OAAOG,SAArB,CAArC,CAAoE;;;;;;;;;;;;;;;AAgBtF;;;;;;;;AAQA,GAAC,CAAC,UAASH,MAAT,EAAiBI,QAAjB,EAA2BC,SAA3B,EAAqC;AACrC,QAAIC,QAAQ,EAAZ;;AAGA;;;;;;;;AAQA,QAAIC,iBAAiB;AACnB;AACAC,gBAAU,OAFS;;AAIn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","file":"app.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"app\", [\"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"app\"] = factory(require(\"jQuery\"));\n\telse\n\t\troot[\"Tg\"] = root[\"Tg\"] || {}, root[\"Tg\"][\"app\"] = factory(root[\"jQuery\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_jquery__) {\nreturn "," \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"./js/app.js\",\"vendor\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n",";(function(window){var hadGlobal='Modernizr' in window;var oldGlobal=window.Modernizr;/*!\n * modernizr v3.6.0\n * Build https://modernizr.com/download?-localstorage-sessionstorage-setclasses-dontmin\n *\n * Copyright (c)\n *  Faruk Ates\n *  Paul Irish\n *  Alex Sexton\n *  Ryan Seddon\n *  Patrick Kettner\n *  Stu Cox\n *  Richard Herrera\n\n * MIT License\n */\n\n/*\n * Modernizr tests which native CSS3 and HTML5 features are available in the\n * current UA and makes the results available to you in two ways: as properties on\n * a global `Modernizr` object, and as classes on the `<html>` element. This\n * information allows you to progressively enhance your pages with a granular level\n * of control over the experience.\n*/\n\n;(function(window, document, undefined){\n  var tests = [];\n  \n\n  /**\n   *\n   * ModernizrProto is the constructor for Modernizr\n   *\n   * @class\n   * @access public\n   */\n\n  var ModernizrProto = {\n    // The current version, dummy\n    _version: '3.6.0',\n\n    // Any settings that don't work as separate modules\n    // can go in here as configuration.\n    _config: {\n      'classPrefix': '',\n      'enableClasses': true,\n      'enableJSClass': true,\n      'usePrefixes': true\n    },\n\n    // Queue of tests\n    _q: [],\n\n    // Stub these for people who are listening\n    on: function(test, cb) {\n      // I don't really think people should do this, but we can\n      // safe guard it a bit.\n      // -- NOTE:: this gets WAY overridden in src/addTest for actual async tests.\n      // This is in case people listen to synchronous tests. I would leave it out,\n      // but the code to *disallow* sync tests in the real version of this\n      // function is actually larger than this.\n      var self = this;\n      setTimeout(function() {\n        cb(self[test]);\n      }, 0);\n    },\n\n    addTest: function(name, fn, options) {\n      tests.push({name: name, fn: fn, options: options});\n    },\n\n    addAsyncTest: function(fn) {\n      tests.push({name: null, fn: fn});\n    }\n  };\n\n  \n\n  // Fake some of Object.create so we can force non test results to be non \"own\" properties.\n  var Modernizr = function() {};\n  Modernizr.prototype = ModernizrProto;\n\n  // Leak modernizr globally when you `require` it rather than force it here.\n  // Overwrite name so constructor name is nicer :D\n  Modernizr = new Modernizr();\n\n  \n\n  var classes = [];\n  \n\n  /**\n   * is returns a boolean if the typeof an obj is exactly type.\n   *\n   * @access private\n   * @function is\n   * @param {*} obj - A thing we want to check the type of\n   * @param {string} type - A string to compare the typeof against\n   * @returns {boolean}\n   */\n\n  function is(obj, type) {\n    return typeof obj === type;\n  }\n  ;\n\n  /**\n   * Run through all tests and detect their support in the current UA.\n   *\n   * @access private\n   */\n\n  function testRunner() {\n    var featureNames;\n    var feature;\n    var aliasIdx;\n    var result;\n    var nameIdx;\n    var featureName;\n    var featureNameSplit;\n\n    for (var featureIdx in tests) {\n      if (tests.hasOwnProperty(featureIdx)) {\n        featureNames = [];\n        feature = tests[featureIdx];\n        // run the test, throw the return value into the Modernizr,\n        // then based on that boolean, define an appropriate className\n        // and push it into an array of classes we'll join later.\n        //\n        // If there is no name, it's an 'async' test that is run,\n        // but not directly added to the object. That should\n        // be done with a post-run addTest call.\n        if (feature.name) {\n          featureNames.push(feature.name.toLowerCase());\n\n          if (feature.options && feature.options.aliases && feature.options.aliases.length) {\n            // Add all the aliases into the names list\n            for (aliasIdx = 0; aliasIdx < feature.options.aliases.length; aliasIdx++) {\n              featureNames.push(feature.options.aliases[aliasIdx].toLowerCase());\n            }\n          }\n        }\n\n        // Run the test, or use the raw value if it's not a function\n        result = is(feature.fn, 'function') ? feature.fn() : feature.fn;\n\n\n        // Set each of the names on the Modernizr object\n        for (nameIdx = 0; nameIdx < featureNames.length; nameIdx++) {\n          featureName = featureNames[nameIdx];\n          // Support dot properties as sub tests. We don't do checking to make sure\n          // that the implied parent tests have been added. You must call them in\n          // order (either in the test, or make the parent test a dependency).\n          //\n          // Cap it to TWO to make the logic simple and because who needs that kind of subtesting\n          // hashtag famous last words\n          featureNameSplit = featureName.split('.');\n\n          if (featureNameSplit.length === 1) {\n            Modernizr[featureNameSplit[0]] = result;\n          } else {\n            // cast to a Boolean, if not one already\n            if (Modernizr[featureNameSplit[0]] && !(Modernizr[featureNameSplit[0]] instanceof Boolean)) {\n              Modernizr[featureNameSplit[0]] = new Boolean(Modernizr[featureNameSplit[0]]);\n            }\n\n            Modernizr[featureNameSplit[0]][featureNameSplit[1]] = result;\n          }\n\n          classes.push((result ? '' : 'no-') + featureNameSplit.join('-'));\n        }\n      }\n    }\n  }\n  ;\n\n  /**\n   * docElement is a convenience wrapper to grab the root element of the document\n   *\n   * @access private\n   * @returns {HTMLElement|SVGElement} The root element of the document\n   */\n\n  var docElement = document.documentElement;\n  \n\n  /**\n   * A convenience helper to check if the document we are running in is an SVG document\n   *\n   * @access private\n   * @returns {boolean}\n   */\n\n  var isSVG = docElement.nodeName.toLowerCase() === 'svg';\n  \n\n  /**\n   * setClasses takes an array of class names and adds them to the root element\n   *\n   * @access private\n   * @function setClasses\n   * @param {string[]} classes - Array of class names\n   */\n\n  // Pass in an and array of class names, e.g.:\n  //  ['no-webp', 'borderradius', ...]\n  function setClasses(classes) {\n    var className = docElement.className;\n    var classPrefix = Modernizr._config.classPrefix || '';\n\n    if (isSVG) {\n      className = className.baseVal;\n    }\n\n    // Change `no-js` to `js` (independently of the `enableClasses` option)\n    // Handle classPrefix on this too\n    if (Modernizr._config.enableJSClass) {\n      var reJS = new RegExp('(^|\\\\s)' + classPrefix + 'no-js(\\\\s|$)');\n      className = className.replace(reJS, '$1' + classPrefix + 'js$2');\n    }\n\n    if (Modernizr._config.enableClasses) {\n      // Add the new classes\n      className += ' ' + classPrefix + classes.join(' ' + classPrefix);\n      if (isSVG) {\n        docElement.className.baseVal = className;\n      } else {\n        docElement.className = className;\n      }\n    }\n\n  }\n\n  ;\n/*!\n{\n  \"name\": \"Local Storage\",\n  \"property\": \"localstorage\",\n  \"caniuse\": \"namevalue-storage\",\n  \"tags\": [\"storage\"],\n  \"knownBugs\": [],\n  \"notes\": [],\n  \"warnings\": [],\n  \"polyfills\": [\n    \"joshuabell-polyfill\",\n    \"cupcake\",\n    \"storagepolyfill\",\n    \"amplifyjs\",\n    \"yui-cacheoffline\"\n  ]\n}\n!*/\n\n  // In FF4, if disabled, window.localStorage should === null.\n\n  // Normally, we could not test that directly and need to do a\n  //   `('localStorage' in window)` test first because otherwise Firefox will\n  //   throw bugzil.la/365772 if cookies are disabled\n\n  // Similarly, in Chrome with \"Block third-party cookies and site data\" enabled,\n  // attempting to access `window.sessionStorage` will throw an exception. crbug.com/357625\n\n  // Also in iOS5 Private Browsing mode, attempting to use localStorage.setItem\n  // will throw the exception:\n  //   QUOTA_EXCEEDED_ERROR DOM Exception 22.\n  // Peculiarly, getItem and removeItem calls do not throw.\n\n  // Because we are forced to try/catch this, we'll go aggressive.\n\n  // Just FWIW: IE8 Compat mode supports these features completely:\n  //   www.quirksmode.org/dom/html5.html\n  // But IE8 doesn't support either with local files\n\n  Modernizr.addTest('localstorage', function() {\n    var mod = 'modernizr';\n    try {\n      localStorage.setItem(mod, mod);\n      localStorage.removeItem(mod);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  });\n\n/*!\n{\n  \"name\": \"Session Storage\",\n  \"property\": \"sessionstorage\",\n  \"tags\": [\"storage\"],\n  \"polyfills\": [\"joshuabell-polyfill\", \"cupcake\", \"sessionstorage\"]\n}\n!*/\n\n  // Because we are forced to try/catch this, we'll go aggressive.\n\n  // Just FWIW: IE8 Compat mode supports these features completely:\n  //   www.quirksmode.org/dom/html5.html\n  // But IE8 doesn't support either with local files\n  Modernizr.addTest('sessionstorage', function() {\n    var mod = 'modernizr';\n    try {\n      sessionStorage.setItem(mod, mod);\n      sessionStorage.removeItem(mod);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  });\n\n\n  // Run each test\n  testRunner();\n\n  // Remove the \"no-js\" class if it exists\n  setClasses(classes);\n\n  delete ModernizrProto.addTest;\n  delete ModernizrProto.addAsyncTest;\n\n  // Run the things that are supposed to run after the tests\n  for (var i = 0; i < Modernizr._q.length; i++) {\n    Modernizr._q[i]();\n  }\n\n  // Leak Modernizr namespace\n  window.Modernizr = Modernizr;\n\n\n;\n\n})(window, document);module.exports=window.Modernizr;if(hadGlobal){window.Modernizr=oldGlobal;}else{delete window.Modernizr;}})(window);","\"use strict\";\r\n/*  TG 2.0 @2018\r\n    Main Client Entry Point */\r\nimport TgClient from \"modules/client.js\";\r\n\r\n(function(document, window) {\r\n    $.ajaxSetup({ cache: true });\r\n\r\n    // enable any bootstrap tooltip\r\n    function onReady() {\r\n        let client = new TgClient();\r\n        client.init();   \r\n    };\r\n\r\n    // TODO: Google Analytics\r\n     \r\n    $(document).ready(onReady);\r\n    \r\n}(document, window));","// ========== NPM Modules\r\nimport io from 'socket.io-client';\r\nimport Modernizr from \"modernizr\";\r\nimport Cookies from 'js-cookie';\r\nimport PerfectScrollbar from 'perfect-scrollbar';\r\nimport 'bootstrap';\r\nimport 'magnific-popup';\r\nimport 'draggabilly/dist/draggabilly.pkgd.js';\r\nimport 'easy-autocomplete';\r\n\r\n//============ Assets file list.\r\nimport AssetsList from 'assets_list.json';\r\n//============ Custom\r\n//import FacebookSDK from 'facebookSdk';\r\nimport Preloader from 'preloader';\r\nimport Map from 'mapDrawer';\r\n\r\n\r\nexport default class TgGui {\r\n\r\n    constructor(options) {\r\n        this.ws_server_addr = '51.38.185.84:3335';\r\n        this.socket_io_resource = 'socket.io';\r\n        this.media_server_addr = 'http://play.thegatemud.it/images/';\r\n        this.ws_prefix = '/';\r\n        this.images_path = './images/';\r\n        this.sounds_path = '';\r\n\r\n        this.socketListener = {}\r\n\r\n        /* Cookies Settings */\r\n        this.cookies = {\r\n            prefix: 'tgwc',\r\n            expires: 365 * 10\r\n        };\r\n\r\n        /* Connection */\r\n        //this.serverIsReady = false;\r\n        this.isConnected = false;\r\n        this.socket = null;\r\n        this.netdata = '';\r\n\r\n        /* Login */\r\n\r\n        this.inGame = false;\r\n        this.isGod = false;\r\n        this.godInvLev = 0;\r\n\r\n        this.connectionInfo = {\r\n            loginName: null,\r\n            loginPass: null,\r\n            error: null\r\n        };\r\n\r\n        this.client_state = {};\r\n\r\n        /* UI Game Options */\r\n        this.client_options = {\r\n            alpha_approved: false,\r\n            shortcuts: [],\r\n            login: {},\r\n            interface: {\r\n                dashboard: 0\r\n            },\r\n            details: {\r\n                compact: false,\r\n            }\r\n        };\r\n\r\n        /* Status */\r\n        this.in_editor = false;\r\n        this.cursor_on_map = false;\r\n\r\n        /* History */\r\n        this.max_history_length = 40;\r\n        this.cmd_history_pos = 0;\r\n        this.cmd_history = [];\r\n\r\n        /* Exits */\r\n        this.dir_north = 0;\r\n        this.dir_east = 1;\r\n        this.dir_south = 2;\r\n        this.dir_west = 3;\r\n        this.dir_up = 4;\r\n        this.dir_down = 5;\r\n\r\n        this.dir_names = ['nord', 'est', 'sud', 'ovest', 'alto', 'basso'];\r\n        this.dir_status = '000000';\r\n\r\n        /* Shortcuts */\r\n        this.shortcuts_map = {};\r\n\r\n        /* Input */\r\n        this.cmd_prefix = '';\r\n\r\n        /* Output */\r\n        this.last_room_desc = '';\r\n\r\n        /* Details */\r\n        this.exp_grp_list = {}\r\n\r\n        /* Health bars */\r\n        this.hlttxtcol = [{\r\n                let: 25,\r\n                txt: 'orangered'\r\n            },\r\n            {\r\n                let: 50,\r\n                txt: 'yellow'\r\n            },\r\n            {\r\n                let: 100,\r\n                txt: 'greenyellow'\r\n            },\r\n        ];\r\n\r\n        this.client_update = {\r\n            interfaceData: {\r\n                info: false,\r\n                stato: false,\r\n            },\r\n            last: 0,\r\n            inventory: {\r\n                version: -1,\r\n                needed: false\r\n            },\r\n            equipment: {\r\n                version: -1,\r\n                needed: false\r\n            },\r\n            room: {\r\n                version: -1,\r\n                needed: false\r\n            }\r\n        };\r\n\r\n        this.scrollbar = {\r\n            output: null\r\n        };\r\n\r\n        /* Debug */\r\n        this.debug = true;\r\n\r\n    }\r\n\r\n    init() {\r\n        let _ = this;\r\n        // Get Cookie \"Italy cookie law\"\r\n        let cookie_consent = _.LoadStorage('cookie_consent');\r\n        // Check Cookie Law Approval Status, then go to start or wait user action.\r\n        if (!cookie_consent) {\r\n            _.showCookieLawDisclaimer();\r\n        } else {\r\n            _.removeCookieLawDisclaimer();\r\n            _.startClient();\r\n        }\r\n    }\r\n\r\n    startClient() {\r\n        let _ = this;\r\n\r\n       /* let facebookSDK = new FacebookSDK();\r\n        facebookSDK.load();\r\n        */\r\n        // Init the Session\r\n        _.initSessionData();\r\n        // Start Server Connection\r\n        _.connectToServer().then(function (resolve, reject) {\r\n            if (_.isConnected) {\r\n                _.initLoginPanel();\r\n            }\r\n            if (_.debug) {\r\n                console.log('Server Status:', _.isConnected);\r\n            }\r\n        });\r\n    }\r\n\r\n    connectToServer() {\r\n        let _ = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            if (_.socket) {\r\n                _.socket.destroy();\r\n                delete _.socket;\r\n                _.socket = null;\r\n            }\r\n\r\n            // Initialize Connection to the WebSocket\r\n            _.socket = io.connect(_.ws_server_addr, {\r\n                'reconnection': true,\r\n                'force new connection': true,\r\n                'resource': _.socket_io_resource,\r\n                'transports': ['polling']\r\n            });\r\n\r\n            // Server status\r\n            _.socket.on('connect', function () {\r\n\r\n                console.log('connect');\r\n                _.isConnected = true;\r\n                _.networkActivityMessage(\"Server Online\", 1);\r\n                resolve(true);\r\n            });\r\n\r\n            _.socket.on('disconnect', function () {\r\n                console.log('disconnect');\r\n                _.setDisconnect();\r\n                _.connectToServer();\r\n                if (!_.connectionInfo.error) {\r\n                    _.networkActivityMessage(\"Disconnesso dal server\");\r\n                }\r\n            });\r\n\r\n            _.socket.on('reconnect_attempt', function () {\r\n                console.log('is a reconnect');\r\n            });\r\n\r\n            _.socket.on('connect_error', function (e) {\r\n                if (_.isConnected) {\r\n                    _.networkActivityMessage(\"Connessione chiusa\");\r\n                } else {\r\n                    _.networkActivityMessage(\"Il server di gioco è offline.\", 0);\r\n                }\r\n                resolve(false);\r\n            });\r\n        });\r\n    }\r\n\r\n    handleLoginData(data) {\r\n        let _ = this;\r\n        if (data.indexOf(\"&!connmsg{\") == 0) {\r\n            let end = data.indexOf('}!');\r\n            let rep = $.parseJSON(data.slice(9, end + 1));\r\n\r\n            if (rep.msg) {\r\n                switch (rep.msg) {\r\n                    case 'ready':\r\n                        _.sendOOB({\r\n                            itime: _.client_state.when.toString(16)\r\n                        });\r\n                        break;\r\n\r\n                    case 'enterlogin':\r\n                        _.performLogin();\r\n                        break;\r\n\r\n                    case 'shutdown':\r\n                        console.log('shutdown');\r\n                        _.networkActivityMessage('Attenzione, il server sarà spento entro breve per manutenzione.');\r\n                        _.performLogin();\r\n                        break;\r\n\r\n                    case 'reboot':\r\n                        console.log('reboot');\r\n                        _.networkActivityMessage('Attenzione, il server sarà riavviato entro breve.');\r\n                        _.performLogin();\r\n                        break;\r\n\r\n                    case 'created':\r\n                    case 'loginok':\r\n\r\n                        // Preload client then start the magic\r\n                        let clientPreloader = new Preloader(AssetsList, _.images_path);\r\n\r\n                        clientPreloader.init().then(function () {\r\n                            //reset login message\r\n                            _.loginNetworkActivityMessage(\"\");\r\n                            _.hideLoginPanel();\r\n                            _.loadInterface();\r\n                            _.completeHandshake();\r\n                            _.handleServerData(data.slice(end + 2));\r\n                        }, () => {\r\n                            console.log(\"Assets error\") // Error!\r\n                        });\r\n\r\n                        // User loged in with Facebook SDK.\r\n\r\n                        /*if(!directLogin)\r\n                        {\r\n                            if (updateChars)\r\n                            {\r\n                                doUpdateCharacters();\r\n                            }\r\n                            \r\n                            moveLoginPanel('login');\r\n                        }*/\r\n                        break;\r\n\r\n                    default:\r\n                        let connectionError = _.getLoginReplyMessage(rep.msg);\r\n                        if (!connectionError)\r\n                            connectionError = _.getLoginReplyMessage('errorproto');\r\n                        _.loginError(connectionError);\r\n                        break;\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    completeHandshake() {\r\n        let _ = this;\r\n        _.socket.off('data');\r\n        _.socket.on('data', _.handleServerData.bind(_));\r\n        _.setHandshaked();\r\n    }\r\n\r\n    handleServerData(msg) {\r\n\r\n        let _ = this;\r\n        _.netdata += msg;\r\n        let len = _.netdata.length;\r\n\r\n        if (_.netdata.indexOf(\"&!!\", len - 3) !== -1) {\r\n\r\n            let data = _.preparseText(_.netdata.substr(0, len - 3));\r\n\r\n            try {\r\n                _.showOutput(_.parseForDisplay(data));\r\n            } catch (err) {\r\n                console.log(err);\r\n            }\r\n\r\n            _.netdata = '';\r\n\r\n        } else if (len > 200000) {\r\n            _.showOutput('<br>Errore di comunicazione con il server!<br>');\r\n            _.netdata = '';\r\n            _.setDisconnect();\r\n        }\r\n    }\r\n\r\n    setHandshaked() {\r\n        this.clearUpdate();\r\n    }\r\n\r\n    clearUpdate() {\r\n        this.client_update.inventory.version = -1;\r\n        this.client_update.inventory.needed = false;\r\n        this.client_update.equipment.version = -1;\r\n        this.client_update.equipment.needed = false;\r\n        this.client_update.room.version = -1;\r\n        this.client_update.room.needed = false;\r\n    }\r\n\r\n\r\n    setDisconnect() {\r\n        let _ = this;\r\n        _.isConnected = false;\r\n        _.inGame = false;\r\n        $('.tg-loginform').show();\r\n    }\r\n\r\n    /* COOKIE LAW */\r\n    showCookieLawDisclaimer() {\r\n        let _ = this;\r\n\r\n        $(document).on('click', '#cookieconsentbutton', function () {\r\n            _.SaveStorage('cookie_consent', true);\r\n            $.magnificPopup.close();\r\n            _.startClient();\r\n        });\r\n\r\n        _.openPopup('cookielaw', \"Cookie Policy\", '');\r\n\r\n    }\r\n\r\n    removeCookieLawDisclaimer() {\r\n        $('.tg-cookielawcontent').remove();\r\n    }\r\n\r\n    initSessionData() {\r\n\r\n        let _ = this;\r\n        // Load State\r\n        let saved_state = Cookies.getJSON(_.cookies.prefix + 'state');\r\n\r\n        if (Modernizr.localstorage && saved_state) {\r\n            _.SaveStorage('state', saved_state);\r\n            Cookies.set(_.cookies.prefix + 'state', null);\r\n        } else {\r\n            saved_state = _.LoadStorage('state');\r\n        }\r\n        if (saved_state) {\r\n            $.extend(_.client_state, saved_state);\r\n        }\r\n        if (_.client_state.when == null) {\r\n            _.client_state.when = new Date().getTime();\r\n            _.SaveStorage('state', _.client_state);\r\n        }\r\n\r\n        // Load Options\r\n        let saved_options = Cookies.getJSON(_.cookies.prefix + 'options');\r\n\r\n        if (Modernizr.localstorage && saved_options) {\r\n            _.SaveStorage('options', saved_options);\r\n            Cookies(cookies.prefix + 'options', null);\r\n        } else {\r\n            saved_options = _.LoadStorage('options');\r\n        }\r\n\r\n        if (saved_options) {\r\n            $.extend(_.client_options, saved_options);\r\n        }\r\n    }\r\n\r\n    LoadStorage(what) {\r\n\r\n        what = this.cookies.prefix + what;\r\n\r\n        if (Modernizr.localstorage) {\r\n            let data = localStorage[what];\r\n            return data ? JSON.parse(data) : null;\r\n        } else {\r\n            return Cookies.get(what);\r\n        }\r\n    }\r\n\r\n    SaveStorage(what, value) {\r\n        let _ = this;\r\n        what = _.cookies.prefix + what;\r\n        if (Modernizr.localstorage) {\r\n            localStorage[what] = JSON.stringify(value);\r\n        } else {\r\n            Cookies.set(what, value, {\r\n                'expires': _.cookies.expires,\r\n                'path': _.cookies.path\r\n            });\r\n        }\r\n    }\r\n\r\n    UploadUserConfiguration() {\r\n        // TODO:\r\n    }\r\n\r\n    ExtractAndSaveUserConfiguration() {\r\n        // TODO:\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     * Login \r\n     */\r\n\r\n    hideLoginPanel() {\r\n        $('.tg-loginpanel').hide();\r\n    }\r\n\r\n    initLoginPanel() {\r\n        let _ = this;\r\n\r\n        //toggle logo visibility\r\n        $('.tg-logo-composit').css('visibility', 'visible');\r\n\r\n        $('#login_username').focus();\r\n        $('#loginPanel').on('submit', function (e) {\r\n            e.preventDefault();\r\n            let name = $('#login_username').val();\r\n            let pass = $('#login_password').val();\r\n            if (!name || !pass) {\r\n                //TODO: Notify user to provide credentials\r\n                return;\r\n            }\r\n            _.loginNetworkActivityMessage(\"Connessione in corso...\");\r\n\r\n            _.connectionInfo.loginName = name;\r\n            _.connectionInfo.loginPass = pass;\r\n            _.connectionInfo.mode = \"login\";\r\n            //Attach oob Socket Handler\r\n            _.socket.on('data', _.handleLoginData.bind(_));\r\n            _.socket.emit('loginrequest');\r\n        });\r\n\r\n        // On New  Character Creation button\r\n        $('#doNewCharacter').on('click', function () {\r\n            _.openPopup('nofeature');\r\n        });\r\n    }\r\n\r\n    performLogin() {\r\n        let _ = this;\r\n        if (_.connectionInfo.mode == 'login') {\r\n            _.sendToServer(\"login:\" + _.connectionInfo.loginName + \",\" + _.connectionInfo.loginPass + \"\\n\");\r\n        }\r\n    }\r\n\r\n    loginErrorClean() {\r\n        _.connectionInfo.error = null;\r\n    }\r\n\r\n    loginError(msg) {\r\n        this.connectionInfo.error = msg;\r\n        this.loginNetworkActivityMessage(msg);\r\n    }\r\n\r\n    \r\n    loginNetworkActivityMessage(msg) {\r\n        $('.tg-loginstatus').text(msg)\r\n    }\r\n\r\n    networkActivityMessage(msg, status) {\r\n        $('.tg-serverstatus').text(msg)\r\n        $('body').attr('data-serverstatus', status);\r\n    }\r\n\r\n    disconnectFromServer() {\r\n        let _ = this;\r\n        if(_.isConnected)\r\n        {\r\n            if(_.inGame)\r\n                _.sendToServer(_.historyPush('fine'));\r\n            else\r\n                _.socket.disconnect();\r\n        }\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n    * MESSAGES PARSE\r\n    */\r\n\r\n    preparseText(msg) {\r\n\r\n        // Remove -not-tags-\r\n        msg = msg.replace(/\\r/gm, '');\r\n        msg = msg.replace(/&!!/gm, '');\r\n        msg = msg.replace(/\\$\\$/gm, '$');\r\n        msg = msg.replace(/%%/gm, '%');\r\n        msg = msg.replace(/&&/gm, '&#38;');\r\n        msg = msg.replace(/</gm, '&#60;');\r\n        msg = msg.replace(/>/gm, '&#62;');\r\n\r\n        return msg;\r\n    }\r\n\r\n    parseForDisplay(msg) {\r\n        let _ = this,\r\n            pos;\r\n\r\n        console.log(msg);\r\n\r\n        //Hide text (password)\r\n        msg = msg.replace(/&x\\n*/gm, function () {\r\n            console.log('input type password enabled');\r\n            // _.inputPassword();\r\n            return '';\r\n        });\r\n\r\n        //Show text (normal input)\r\n        msg = msg.replace(/&e\\n*/gm, function () {\r\n            console.log('input type text enabled');\r\n            //inputText();\r\n            return '';\r\n        });\r\n\r\n        // Sky picture\r\n        msg = msg.replace(/&o.\\n*/gm, function (sky) {\r\n            let sky_parse = sky.charAt(2);\r\n            _.setSky(sky_parse);\r\n            return '';\r\n        });\r\n\r\n        // Exits info\r\n        msg = msg.replace(/&d\\d{6}\\n*/gm, function (doors) {\r\n            let doors_parse = doors.substr(2, 6);\r\n            _.setDoors(doors_parse);\r\n            return '';\r\n        });\r\n\r\n        // Audio\r\n        msg = msg.replace(/&!au\"[^\"]*\"\\n*/gm, function (audio) {\r\n            let audio_parse = audio.slice(5, audio.lastIndexOf('\"'));\r\n            _.playAudio(audio_parse);\r\n            return '';\r\n        });\r\n\r\n        // Player status\r\n        msg = msg.replace(/&!st\"[^\"]*\"\\n*/gm, function (status) {\r\n            let status_parse = status.slice(5, status.lastIndexOf('\"')).split(',');\r\n            return _.setStatus(status_parse);\r\n        });\r\n\r\n        // Player status\r\n        msg = msg.replace(/&!up\"[^\"]*\"\\n*/gm, function (update) {\r\n            let update_parse = update.slice(5, status.lastIndexOf('\"')).split(',');\r\n\r\n            if (update_parse[0] > _.client_update.inventory.version)\r\n                _.client_update.inventory.needed = true;\r\n\r\n            if (update_parse[1] > _.client_update.equipment.version)\r\n                _.client_update.equipment.needed = true;\r\n\r\n            if (update_parse[2] > _.client_update.room.version)\r\n                _.client_update.room.needed = true;\r\n\r\n            return '';\r\n        });\r\n\r\n        // Image in side frame (with gamma)\r\n        msg = msg.replace(/&!img\"[^\"]*\"\\n*/gm, function (image) {\r\n            console.log('show image with gamma');\r\n            //     // var image = image.slice(6, image.lastIndexOf('\"')).split(',');\r\n            //     // showImageWithGamma(image[0], image[1], image[2], image[3]);\r\n            return '';\r\n        });\r\n\r\n        // Image in side frame\r\n        msg = msg.replace(/&!im\"[^\"]*\"\\n*/gm, function (image) {\r\n            let image_parse = image.slice(5, image.lastIndexOf('\"'));\r\n            _.showImage(image_parse);\r\n            return '';\r\n        });\r\n\r\n        // Player is logged in\r\n        msg = msg.replace(/&!logged\"[^\"]*\"/gm, function () {\r\n            _.inGame = true;\r\n            _.processCommands('info; stat', false);\r\n            return '';\r\n        });\r\n\r\n        // Close the text editor\r\n        msg = msg.replace(/&!ea\"[^\"]*\"\\n*/gm, function (options) {\r\n            _.closeEditor();\r\n            return '';\r\n        });\r\n\r\n        // Open the text editor\r\n        msg = msg.replace(/&!ed\"[^\"]*\"\\n*/gm, function (options) {\r\n            let options_parse = options.slice(5, options.lastIndexOf('\"')).split(',');\r\n            let text = options_parse.slice(2).toString().replace(/\\n/gm, ' ');\r\n            _.openEditor(options_parse[0], options_parse[1], text);\r\n            return '';\r\n        });\r\n\r\n        // Map data\r\n        msg = msg.replace(/&!map\\{[\\s\\S]*?\\}!/gm, function (map) {\r\n            let map_parse = $.parseJSON(map.slice(5, -1));\r\n            _.MAP_OBJECT.updateMap(map_parse);\r\n            return '';\r\n        });\r\n\r\n        // Book\r\n        msg = msg.replace(/&!book\\{[\\s\\S]*?\\}!/gm, function (b) {\r\n            let b_parse = $.parseJSON(b.slice(6, -1));\r\n            console.log('open book');\r\n            // openBook(b);\r\n            return '';\r\n        });\r\n\r\n        // List of commands\r\n        msg = msg.replace(/&!cmdlst\\{[\\s\\S]*?\\}!/gm, function (cmd) {\r\n            let cmd_parse = $.parseJSON(cmd.slice(8, -1).replace(/\"\"\"/, '\"\\\\\"\"'));\r\n            console.log('return commands list');\r\n            //return _.renderCommandsList(cmd_parse);\r\n        });\r\n\r\n        // Generic page (title, text)\r\n        msg = msg.replace(/&!page\\{[\\s\\S]*?\\}!/gm, function (p) {\r\n            let page_parse = $.parseJSON(p.slice(6, -1)); /* .replace(/\\n/gm,' ') */\r\n            // return addFrameStyle(addBannerStyle(p.title) + '<div class=\"text\">' + p.text.replace(/\\n/gm, '<br>') + '</div>');\r\n            let page_html = '<div class=\"tg-title lt-red\">' + page_parse.title + '</div><div class=\"text\">' + page_parse.text.replace(/\\n/gm, '<br>') + '</div>';\r\n            if (page_parse.title == 'Notizie') {\r\n                _.openPopup('notizie');\r\n            } else {\r\n                //TODO: Page parse generic \r\n                console.log('!page todo');\r\n            }\r\n            return '';\r\n        });\r\n\r\n        // Generic table (title, head, data)\r\n        msg = msg.replace(/&!table\\{[\\s\\S]*?\\}!/gm, function (t) {\r\n            let gtable_parse = $.parseJSON(t.slice(7, -1));\r\n            console.log('Generic table');\r\n            //return _.renderTable(gtable_parse);\r\n        });\r\n\r\n        // Inventory\r\n        msg = msg.replace(/&!inv\\{[\\s\\S]*?\\}!/gm, function (inv) {\r\n            let inv_parse = $.parseJSON(inv.slice(5, -1));\r\n            console.log('inventory');\r\n            // renderInventory(inv_parse);\r\n            return '';\r\n        });\r\n\r\n        // Room details\r\n        msg = msg.replace(/&!room\\{[\\s\\S]*?\\}!/gm, function (dtls) {\r\n            let dtls_parse = $.parseJSON(dtls.slice(6, -1));\r\n            return _.renderDetails(dtls_parse, dtls_parse.dir ? 'dir' : 'room');\r\n        });\r\n\r\n        // Person details\r\n        msg = msg.replace(/&!pers\\{[\\s\\S]*?\\}!/gm, function (dtls) {\r\n            let dtls_parse = $.parseJSON(dtls.slice(6, -1));\r\n            return _.renderDetails(dtls_parse, 'pers');\r\n        });\r\n\r\n        // Object details\r\n        msg = msg.replace(/&!obj\\{[\\s\\S]*?\\}!/gm, function (dtls) {\r\n            let dtls_parse = $.parseJSON(dtls.slice(5, -1).replace(/\\n/gm, ' '));\r\n            return _.renderDetailsInText(dtls_parse, 'obj');\r\n        });\r\n\r\n        // Equipment\r\n        msg = msg.replace(/&!equip\\{[\\s\\S]*?\\}!/gm, function (eq) {\r\n            let eq_parse = $.parseJSON(eq.slice(7, -1).replace(/\\n/gm, '<br>'));\r\n            console.log('renderEquipment');\r\n            //_.renderEquipment(eq_parse);\r\n            _.openPopup('nofeature');\r\n            return '';\r\n        });\r\n\r\n        // Workable lists\r\n        msg = msg.replace(/&!wklst\\{[\\s\\S]*?\\}!/gm, function (wk) {\r\n            let wk_parse = $.parseJSON(wk.slice(7, -1));\r\n            console.log('renderworkslist');\r\n            _.openPopup('nofeature');\r\n            //return renderWorksList(wk);\r\n        });\r\n\r\n        // Skill list\r\n        msg = msg.replace(/&!sklst\\{[\\s\\S]*?\\}!/gm, function (skinfo) {\r\n            let skinfo_parse = $.parseJSON(skinfo.slice(7, -1));\r\n            console.log('renderSkillsList');\r\n            //return renderSkillsList(skinfo_parse);\r\n        });\r\n\r\n        // Player info\r\n        msg = msg.replace(/&!pginf\\{[\\s\\S]*?\\}!/gm, function (info) {\r\n            let info_parse = $.parseJSON(info.slice(7, -1));\r\n            if (!_.client_update.interfaceData.info) {\r\n                _.setDataInterface('info', info_parse);\r\n                _.client_update.interfaceData.info = true;\r\n                return '';\r\n            } else {\r\n                //TODO: Carefully, after change desc this msg will be call\r\n                return '';\r\n                //return renderPlayerInfo(info);\r\n            }\r\n        });\r\n\r\n        // Player status\r\n        msg = msg.replace(/&!pgst\\{[\\s\\S]*?\\}!/gm, function (status) {\r\n            let status_parse = $.parseJSON(status.slice(6, -1));\r\n            if (!_.client_update.interfaceData.stato) {\r\n                _.setDataInterface('stato', status_parse);\r\n                _.client_update.interfaceData.stato = true;\r\n                return '';\r\n            } else {\r\n                _.setDataInterface('stato', status_parse);\r\n                //return _.renderPlayerStatus(status_parse);\r\n            }\r\n            return '';\r\n        });\r\n\r\n        // Selectable generic\r\n        msg = msg.replace(/&!select\\{[\\s\\S]*?\\}!/gm, function (s) {\r\n            s = $.parseJSON(s.slice(8, -1));\r\n            console.log('selectDialog');\r\n            //return selectDialog(s);\r\n        });\r\n\r\n        // Refresh command\r\n        msg = msg.replace(/&!refresh\\{[\\s\\S]*?\\}!/gm, function (t) {\r\n            let rcommand_parse = $.parseJSON(t.slice(9, -1));\r\n            return _.handleRefresh(rcommand_parse);\r\n        });\r\n\r\n        // Pause scroll\r\n        msg = msg.replace(/&!crlf\"[^\"]*\"/gm, function () {\r\n            _.pauseOn();\r\n            return '';\r\n        });\r\n\r\n        // Clear message\r\n        pos = msg.lastIndexOf('&*');\r\n        if (pos >= 0) {\r\n            _.clearOutput();\r\n            msg = msg.slice(pos + 2);\r\n        }\r\n\r\n        // Filterable messages\r\n        msg = msg.replace(/&!m\"(.*)\"\\{([\\s\\S]*?)\\}!/gm, function (line, type, msg) {\r\n            console.log('addFilterTag');\r\n            //  return addFilterTag(type, msg);\r\n        });\r\n\r\n\r\n        msg = msg.replace(/&!ce\"[^\"]*\"/gm, function (image) {\r\n            let image_parse = image.slice(5, -1);\r\n            console.log('renderEmbeddedImage');\r\n            //return renderEmbeddedImage(image_parse);\r\n        });\r\n\r\n        msg = msg.replace(/&!ulink\"[^\"]*\"/gm, function (link) {\r\n            let link_parse = link.slice(8, -1).split(',');\r\n            console.log('renderLink');\r\n            //            return renderLink(link_parse[0], link_parse[1]);\r\n        });\r\n\r\n        msg = msg.replace(/&!as\"[^\"]*\"/gm, '');\r\n\r\n        msg = msg.replace(/&!(ad|a)?m\"[^\"]*\"/gm, function (mob) {\r\n            let mob_parse = mob.slice(mob.indexOf('\"') + 1, -1).split(',');\r\n            let desc_parse = mob.slice(5).toString();\r\n            return _.renderMob(mob_parse[0], mob_parse[1], mob_parse[2], mob_parse[3], desc_parse, 'interact pers');\r\n        });\r\n\r\n        msg = msg.replace(/&!(ad|a)?o\"[^\"]*\"/gm, function (obj) {\r\n            let obj_parse = obj.slice(obj.indexOf('\"') + 1, -1).split(',');\r\n            let desc_parse = obj.slice(5).toString();\r\n            return _.renderObject(obj_parse[0], obj_parse[1], obj_parse[2], obj_parse[3], desc_parse, 'interact obj');\r\n        });\r\n\r\n        msg = msg.replace(/&!sm\"[^\"]*\"/gm, function (icon) {\r\n            let icon_parse = icon.slice(5, -1).split(',');\r\n            return _.renderIcon(icon_parse[0], icon_parse[1], 'room', null, null, 'interact pers');\r\n        });\r\n\r\n        msg = msg.replace(/&!si\"[^\"]*\"/gm, function (icon) {\r\n            let icon_parse = icon.slice(5, -1).split(',');\r\n            return _.renderIcon(icon_parse[0], null, null, null, null, \"v\" + icon_parse[1]);\r\n        });\r\n\r\n        msg = msg.replace(/&i/gm, function () {\r\n            _.isGod = true;\r\n            return '';\r\n        });\r\n\r\n        msg = msg.replace(/&I\\d/gm, function (inv) {\r\n            _.godInvLev = parseInt(inv.substr(2, 3));\r\n            return '';\r\n        });\r\n\r\n        /* \\r is already removed at top */\r\n        msg = msg.replace(/\\n/gm, '<br>');\r\n\r\n        if (msg != '') {\r\n            msg = _.replaceColors('<div class=\"tgline\">' + msg + '</div>');\r\n        }\r\n\r\n        return msg.replace(/<p><\\/p>/g, '');\r\n\r\n    }\r\n\r\n    handleRefresh(r) {\r\n        let _ = this;\r\n        if (this.isModalOpen) {\r\n            _.sendToServer(r.cmd);\r\n        }\r\n        return '';\r\n    }\r\n\r\n    replaceColors(msg) {\r\n        msg = msg.replace(/&B/gm, '<div class=\"tg-gray\">');\r\n        msg = msg.replace(/&R/gm, '<div class=\"tg-lt-red\">');\r\n        msg = msg.replace(/&G/gm, '<div class=\"tg-lt-green\">');\r\n        msg = msg.replace(/&Y/gm, '<div class=\"tg-yellow\">');\r\n        msg = msg.replace(/&L/gm, '<div class=\"tg-lt-blue\">');\r\n        msg = msg.replace(/&M/gm, '<div class=\"tg-lt-magenta\">');\r\n        msg = msg.replace(/&C/gm, '<div class=\"tg-lt-cyan\">');\r\n        msg = msg.replace(/&W/gm, '<div class=\"tg-white\">');\r\n        msg = msg.replace(/&b/gm, '<div class=\"tg-black\">');\r\n        msg = msg.replace(/&r/gm, '<div class=\"tg-red\">');\r\n        msg = msg.replace(/&g/gm, '<div class=\"tg-green\">');\r\n        msg = msg.replace(/&y/gm, '<div class=\"tg-brown\">');\r\n        msg = msg.replace(/&l/gm, '<div class=\"tg-blue\">');\r\n        msg = msg.replace(/&m/gm, '<div class=\"tg-magenta\">');\r\n        msg = msg.replace(/&c/gm, '<div class=\"tg-cyan\">');\r\n        msg = msg.replace(/&w/gm, '<div class=\"tg-lt-white\">');\r\n        msg = msg.replace(/&-/gm, '</div>');\r\n\r\n        return msg;\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     * MISC RENDERING\r\n     */\r\n\r\n    renderMob(icon, condprc, count, mrn, desc, addclass) {\r\n        return '<div class=\"mob\">' + this.renderIcon(icon, mrn, 'room', null, null, addclass) + '<span class=\"desc\">' + _.decoratedDescription(condprc, null, null, count, desc) + '</span></div>'\r\n    }\r\n\r\n    decoratedDescription(condprc, moveprc, wgt, count, desc) {\r\n        let _ = this;\r\n        let countStr = '';\r\n\r\n        if (count > 1)\r\n            countStr = '&#160;<span class=\"cnt\">[x' + count + ']</span>';\r\n\r\n        return _.renderMinidetails(condprc, moveprc, wgt) + desc.replace(/\\n/gm, ' ') + countStr;\r\n    }\r\n\r\n    renderMinidetails(condprc, moveprc, wgt) {\r\n        let pos = -11 * Math.floor(22 * (100 - condprc) / 100);\r\n        return '<div class=\"hstat\" style=\"background-position:0 ' + pos + 'px\" condprc=\"' + condprc + '\"' + (moveprc ? ' moveprc=\"' + moveprc + '\"' : \"\") + (wgt != null ? ' wgt=\"' + wgt + '\"' : \"\") + '></div>';\r\n    }\r\n\r\n    renderObject(icon, condprc, count, mrn, desc, addclass) {\r\n        return '<div class=\"obj\">' + _.renderIcon(icon, mrn, 'room', null, null, addclass) + '<span class=\"desc\">' + _.decoratedDescription(condprc, null, null, count, desc) + '</span></div>'\r\n    }\r\n\r\n    setDataInterface(cmd, data) {\r\n        let _ = this;\r\n\r\n        if (cmd == 'info') {\r\n            // Name\r\n            $('#charName').html(data.name);\r\n            // Character Image\r\n            if(data.image) {\r\n                $('.tg-characteravatar img').attr('src', _.media_server_addr + data.image);\r\n            }\r\n            /* Info Tooltips */\r\n            $('.tg-characteravatar').attr('title', data.name + ' ' + data.title);\r\n\r\n        } else if (cmd == 'stato') {\r\n            if (data.conv) {\r\n                $('.tg-infocharname .icon-conva').removeClass('d-none');\r\n            } else {\r\n                $('.tg-infocharname .icon-conva').addClass('d-none');\r\n            }\r\n\r\n            /* Healt, Move, Food and Drink bars */\r\n            $('#foodBarText .barC').width(data.food + '%');\r\n            $('#foodBarText i').text(data.food);\r\n            $('#drinkBarText .barC').width(data.drink + '%')\r\n            $('#drinkBarText i').text(data.drink);\r\n\r\n            /* Set Character Status */\r\n            if (data.conv == true) {\r\n                $('.pg-status').text('( sei convalescente! )');\r\n            }\r\n\r\n           \r\n        }\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     *  Editor \r\n     */\r\n\r\n    openEditor(maxchars, title, text) {\r\n        let _ = this;\r\n\r\n        let textarea = $('#editorTextArea').val(text);\r\n        $('#editorTitle').text(title);\r\n\r\n        _.openPopup('editor');\r\n\r\n        $('#abortEditor, #mfp-close').one('click', function () {\r\n            _.abortEdit();\r\n            _.closeEditor();\r\n        });\r\n        $('#saveEditor').one('click', function () {\r\n            _.saveEdit(80);\r\n            _.closeEditor();\r\n        });\r\n\r\n        // Max Chars counter\r\n        let text_max = maxchars;\r\n        $('#editorMaxCharsCount').html(text_max + ' caratteri rimasti');\r\n        textarea.attr('maxlength', maxchars);\r\n        textarea.keyup(function () {\r\n            let text_length = $(this).val().length;\r\n            let text_remaining = text_max - text_length;\r\n\r\n            $('#editorMaxCharsCount').html(text_remaining + ' caratteri rimasti');\r\n        });\r\n\r\n        _.in_editor = true;\r\n    }\r\n\r\n    closeEditor() {\r\n        let _ = this;\r\n        _.in_editor = false;\r\n\r\n        $.magnificPopup.close();\r\n        _.focusInput();\r\n    }\r\n\r\n    abortEdit() {\r\n        if (this.in_editor) {\r\n            this.sendToServer('##ce_abort');\r\n        }\r\n    }\r\n\r\n    saveEdit(maxLinelen) {\r\n\r\n        let _ = this;\r\n\r\n        let text = $('#editorTextArea').val().split('\\n');\r\n\r\n        for (let l = 0; l < text.length; l++) {\r\n            let remText = text[l]\r\n            while (remText.length > 0) {\r\n\r\n                var currline,\r\n                    slicepos = remText.lastIndexOf(' ', maxLinelen);\r\n\r\n                if (slicepos > 0) {\r\n                    currline = remText.slice(0, slicepos) + '\\\\';\r\n                    remText = remText.slice(slicepos);\r\n                } else {\r\n                    currline = remText;\r\n                    remText = '';\r\n                }\r\n\r\n                _.sendToServer('##ce' + currline);\r\n            }\r\n        }\r\n        _.sendToServer('##ce_save');\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     *  IMAGES IN OUTPUT \r\n     */\r\n\r\n    showImage(cont, image) {\r\n        let _ = this;\r\n        let imgsrc = _.images_path + '/' + image;\r\n        let currimgsrc = cont.attr('src');\r\n\r\n        if (currimgsrc != imgsrc)\r\n            cont.attr('src', imgsrc);\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * OUTPUT BUTTONS\r\n     */\r\n\r\n    pauseOn() {\r\n        console.log('pauseON');\r\n        // if(autoscroll_enabled) {\r\n        //     autoscroll_enabled = false;\r\n        //     $('#pausebutton').button(\"option\", \"icons\", { primary: 'ui-icon-custom-play' });\r\n    }\r\n\r\n    pauseOff() {\r\n        console.log('pauseOFF');\r\n        // if(!autoscroll_enabled) {\r\n        //     autoscroll_enabled = true;\r\n        //     $('#pausebutton').button(\"option\", \"icons\", { primary: 'ui-icon-custom-pause' });\r\n        // }\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     * ICONS\r\n     */\r\n\r\n    tileBgPos(tilenum) {\r\n        let _ = this;\r\n        var tc = _.tileCoords(tilenum);\r\n        return '-' + tc[0] + 'px -' + tc[1] + 'px';\r\n    }\r\n\r\n    tileCoords(tilenum) {\r\n        var posx = 32 * (tilenum & 0x7f);\r\n        var posy = 32 * (tilenum >> 7);\r\n        return [posx, posy];\r\n    }\r\n\r\n    renderIcon(icon, mrn, cnttype, cntmrn, cmd, addclass) {\r\n        let _ = this;\r\n        if (!icon)\r\n            icon = 416;\r\n\r\n        return '<div class=\"iconimg ico_' + icon + ' ' + (addclass ? ' ' + addclass : '') + '\" style=\"background-position:' + _.tileBgPos(icon) + '\"' + (mrn ? ' mrn=\"' + mrn + '\"' : '') + (cmd ? ' cmd=\"' + cmd + '\"' : '') + (cnttype ? ' cnttype=\"' + cnttype + '\"' : '') + (cntmrn ? ' cntmrn=\"' + cntmrn + '\"' : '') + '></div>';\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * SKY\r\n     */\r\n\r\n    setSky(sky) {\r\n        //let skypos = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'N', 'd', 'e', 'f', 'g', 'i', 'o', 'p', 'q', 'r', 's', 't', 'u', 'w', 'y'];\r\n\r\n        /*  5: alba \r\n            o: mattina\r\n            i: tramonto\r\n            t: neve\r\n            q: mattina nuvolosa\r\n        */\r\n        let skypos = ['o', 'N', 'w', 'i', 't', 'q'];\r\n\r\n        console.log('%c' + sky, 'background: red; color: #fff');\r\n        console.log(skypos.indexOf(sky));\r\n        /*    if(sky != 'q' && sky != 'N' && sky !='w' && sky !=5) { //test\r\n                    sky = 'q';\r\n                }\r\n        */\r\n        $('#sky').css('background-position', '0 -' + (skypos.indexOf(sky) * 215) + 'px');\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * DOORS & DIRECTION\r\n     */\r\n\r\n    goDir(dir) {\r\n\r\n        let _ = this;\r\n\r\n        let cmd;\r\n\r\n        if (_.godinvlev == 0 && _.dir_status[dir] == '3') {\r\n            cmd = 'apri ' + _.dir_names[dir];\r\n        } else if (_.godinvlev == 0 && _.dir_status[dir] == '4') {\r\n            cmd = 'sblocca ' + _.dir_names[dir];\r\n        } else {\r\n            cmd = _.dir_names[dir];\r\n        }\r\n\r\n        // Do not push into history\r\n        if (cmd) {\r\n            _.sendToServer(cmd);\r\n        }\r\n    }\r\n\r\n\r\n    setDoors(doors) {\r\n        let _ = this;\r\n        for(var d = 0; d < _.dir_names.length; ++d) {\r\n            $('#' + _.dir_names[d] + ' .dir-ico').css('background-position', -26 * doors[d]);   \r\n        }\r\n\r\n        _.dir_status = doors;\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * AUDIO & MUSIC\r\n     */\r\n\r\n    playAudio() {\r\n        console.log('TODO:playaudio')\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * PLAYER STATUS\r\n     */\r\n\r\n    updatePlayerStatus(hprc, mprc) {\r\n        let _ = this;\r\n        let hcolor = _.prcLowTxt(hprc, _.hlttxtcol);\r\n        let mcolor = _.prcLowTxt(hprc, _.hlttxtcol);\r\n\r\n        $('.movebar').width(_.limitPrc(mprc) + '%');\r\n        $('#moveBarText i').css('color', mcolor).text(mprc);\r\n\r\n        $('.healthbar').width(_.limitPrc(hprc) + '%');\r\n        $('#healtBarText i').css('color', hcolor).text(hprc);\r\n    }\r\n\r\n    setStatus(st) {\r\n        //TODO: in combat or not \r\n        let _ = this;\r\n        _.updatePlayerStatus(st[0], st[1]);\r\n        return '';\r\n    }\r\n\r\n    /* *****************************************************************************\r\n     * MAP\r\n     */\r\n\r\n    renderDetailsInText(info, type) {\r\n        let _ = this;\r\n        let res = '';\r\n\r\n        if (info.title) {\r\n            res += '<div class=\"room\"><div class=\"lts\"></div>' + _.capFirstLetter(info.title) + '<div class=\"rts\"></div></div>';\r\n        }\r\n        /* addBannerStyle(capFirstLetter(info.title), 'mini', 'long'); */\r\n\r\n        res += _.renderDetailsInner(info, type);\r\n\r\n        if (info.image)\r\n            _.showImage($('#image-cont'), info.image);\r\n\r\n        return res;\r\n    }\r\n\r\n    renderDetailInSecondOutput(info, type) {\r\n        let _ = this,\r\n            res = '',\r\n            container = $('.tg-output-detail').empty(),\r\n            details = $(_.replaceColors(_.renderDetailsInner(info, '')));\r\n\r\n        container.append(details);\r\n\r\n        if (type == 'room') {\r\n            if (_.client_update.room.version < info.ver) {\r\n                _.client_update.room.version = info.ver;\r\n                _.client_update.room.needed = false;\r\n            }\r\n        }\r\n\r\n        return res;\r\n    }\r\n\r\n    renderDetails(info, type) {\r\n        return this.renderDetailsInText(info, type);\r\n        //return this.renderDetailInSecondOutput(info, type);\r\n\r\n    }\r\n\r\n    renderDetailsInner(info, type) {\r\n        let _ = this;\r\n        let numberClassList = ' firstlist';\r\n        let textarea = '';\r\n\r\n        if (info.action) {\r\n            textarea += '<div class=\"details-inner\">' + info.action + '</div>';\r\n        }\r\n        /* Print description */\r\n        if (info.desc) {\r\n            textarea += '<div class=\"tg-description\">';\r\n            if (info.desc.base) {\r\n                if (type == 'room') {\r\n                    _.last_room_desc = _.formatText(info.desc.base, 'tg-descbase');\r\n                    textarea += _.formatText(info.desc.base, 'tg-descbase');\r\n                }\r\n            } else if (info.desc.repeatlast && _.last_room_desc) {\r\n                textarea += _.last_room_desc;\r\n            }\r\n            textarea += '</div>';\r\n\r\n            if (info.desc.details) {\r\n                textarea += _.formatText(info.desc.details, 'tg-yellow d-block tg-character-subdetail');\r\n            }\r\n\r\n            if (info.desc.equip) {\r\n                textarea += _.formatText(info.desc.equip, 'tg-green d-block tg-character-subdetail');\r\n            }\r\n        }\r\n\r\n        // if(inDialog) \r\n        // else \r\n\r\n        /* Print Objects List */\r\n        if (info.objcont) {\r\n            numberClassList = info.perscont ? numberClassList : '';\r\n            textarea += _.renderDetailsList(type, info.num, info.objcont, 'obj', 'tg-yellow tg-list-object' + numberClassList);\r\n        }\r\n\r\n        /* Print Persons List */\r\n        if (info.perscont) {\r\n            numberClassList = !info.objcont ? numberClassList : '';\r\n            textarea += _.renderDetailsList(type, info.num, info.perscont, 'pers', 'tg-lt-green tg-list-person' + numberClassList);\r\n        }\r\n\r\n\r\n        return textarea;\r\n    }\r\n\r\n    renderDetailsList(cont_type, cont_num, cont, type, style) {\r\n        let _ = this;\r\n        let res = '',\r\n            txt = '';\r\n\r\n        if (cont.list) {\r\n            if (cont_type == 'pers' || cont_type == 'equip') {\r\n                cont.list.sort(function (a, b) {\r\n                    /*let eq_pos_a = $.isArray(a.eq) ? pos_to_order[a.eq[0]] : 0;\r\n                    let eq_pos_b = $.isArray(b.eq) ? pos_to_order[b.eq[0]] : 0;\r\n                    return eq_pos_a - eq_pos_b;*/\r\n                    //return (eq_post_a) -  (eq_pos__b = '');\r\n                });\r\n            }\r\n\r\n            for (let n = 0; n < cont.list.length; n++) {\r\n                let l = cont.list[n];\r\n                let is_group = (l.mrn && l.mrn.length) > 1;\r\n                let opened = (l.mrn && _.exp_grp_list[l.mrn[l.mrn.length - 1]]);\r\n                let tradd = 'class=\"tg-element\"',\r\n                    tdadd = '';\r\n\r\n\r\n                if (is_group) {\r\n\r\n                    tradd = ' class=\"grpcoll\" data-mrn=\"' + l.mrn[l.mrn.length - 1] + '\"';\r\n\r\n                    if (opened) {\r\n                        tradd += ' style=\"display:none\"';\r\n                    }\r\n\r\n                    tdadd += '<div class=\"expicon\"></div>';\r\n                }\r\n\r\n\r\n                txt += '<div ' + tradd + '>';\r\n                txt += '<div>' + tdadd + '</div>';\r\n                txt += '<div class=\"tg-mobicon\">' + _.renderIcon(l.icon, l.mrn ? l.mrn[0] : null, cont_type, l.cntnum, null, 'interact ' + type) + '</div>';\r\n                txt += '<div class=\"tg-mob-description\">' + _.decoratedDescription(l.condprc, l.mvprc, l.wgt, l.sz ? l.sz : 1, (l.eq ? '<b>' + equip_positions_by_num[l.eq[0]] + '</b>: ' : '') + l.desc) + '</div>';\r\n                txt += '</div>';\r\n                if (is_group) {\r\n                    txt += '<div class=\"grpexp\"';\r\n\r\n                    if (!opened) {\r\n                        txt += ' style=\"display:none\"';\r\n                    }\r\n                    txt += '>'\r\n                    for (let m = 0; m < l.mrn.length; m++)\r\n                        txt += '<div>' + (m == 0 ? '<div class=\"collicon\"></div>' : '') + '</div><div>' + _.renderIcon(l.icon, l.mrn[m], cont_type, l.cntnum, null, 'interact ' + type) + '</div></div><div>' + _.decoratedDescription(l.condprc, l.mvprc, l.wgt, 1, l.desc) + '</div></div>';\r\n                    if (l.sz && l.sz > l.mrn.length)\r\n                        txt += '<div><div></div><div><div>' + _.renderIcon(l.icon, null, cont_type, l.cntnum, null, /* 'interact '+type */ null) + '</div></div><div>' + _.decoratedDescription(l.condprc, l.mvprc, l.wgt, l.sz - l.mrn.length, l.desc) + '</div></div>';\r\n                    txt += '</div>';\r\n                }\r\n\r\n            }\r\n            if (cont.title && (txt.length > 0 || cont.show === true)) {\r\n                res += '<p>' + cont.title;\r\n                if (txt.length == 0)\r\n                    res += '<br>Niente.';\r\n                res += '</p>';\r\n            }\r\n\r\n            if (txt.length > 0) {\r\n                res += '<div class=\"tg-outputlist' + (style ? ' ' + style : '') + (_.client_options.details.compact ? ' compact' : '') + '\" data-type=\"' + cont_type + '\"' + (cont_num ? '\" data-mrn=\"' + cont_num + '\"' : '') + '>' + txt + '</div>';\r\n            }\r\n        }\r\n\r\n\r\n        return res;\r\n    }\r\n\r\n    capFirstLetter(string) {\r\n        return string.charAt(0).toUpperCase() + string.slice(1);\r\n    }\r\n\r\n\r\n    formatText(text, style) {\r\n        let page = '';\r\n        let parags = text.replace(/\\r/gm, '').replace(/([^.:?!,])\\s*\\n/gm, '$1 ').split(/\\n/);\r\n\r\n        $.each(parags, function (i, p) {\r\n            if (p != '') {\r\n                page += '<div' + (style ? ' class=\"' + style + '\"' : '') + '>' + p + '</div>';\r\n            }\r\n        });\r\n\r\n        return page;\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     * STATUS BAR\r\n     */\r\n\r\n    limitPrc(prc) {\r\n        if (prc < 0)\r\n            prc = 0;\r\n        else if (prc > 100)\r\n            prc = 100;\r\n\r\n        return prc;\r\n    }\r\n\r\n    prcLowTxt(val, values) {\r\n        for (var i = 0; i < values.length; ++i) {\r\n            if (val <= values[i].val) {\r\n                return values[i].txt;\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n\r\n    prcHighTxt(val, values) {\r\n        for (var i = 0; i < values.length; ++i) {\r\n            if (val >= values[i].val)\r\n                return values[i].txt;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    sendOOB(data) {\r\n        let _ = this;\r\n\r\n        if (!_.isConnected) {\r\n            return;\r\n        }\r\n        _.socket.emit('oob', data);\r\n    }\r\n\r\n    processCommands(text, save_history) {\r\n        let _ = this;\r\n        if (_.inGame) {\r\n            let cmds = _.parseInput(text);\r\n\r\n            if (cmds) {\r\n                //check if cmd will be pushed in the history array\r\n                if (save_history) {\r\n                    _.historyPush(text);\r\n                }\r\n\r\n                for (let i = 0; i < cmds.length; i++) {\r\n                    _.sendToServer(cmds[i]);\r\n                }\r\n            }\r\n        } else {\r\n            _.sendToServer(text);\r\n            $('#tgInputUser').val('').focus();\r\n        }\r\n    }\r\n\r\n    parseInput(input) {\r\n\r\n        let _ = this;\r\n        /* Split input separated by ; */\r\n        let inputs = input.split(/\\s*;\\s*/);\r\n        let res = [];\r\n\r\n        /* Substitute shortcuts on each command and join results */\r\n        for (let i = 0; i < inputs.length; ++i) {\r\n            var subs = _.substShort(inputs[i]).split(/\\s*;\\s*/);\r\n            res = res.concat(subs);\r\n        }\r\n\r\n        /* Return the resulting array */\r\n        return res;\r\n    }\r\n\r\n    substShort(input) {\r\n\r\n        let _ = this;\r\n        // Split into arguments\r\n        let args = input.split(/\\s+/);\r\n\r\n        // Get the shortcut index\r\n        let shortcut_key = args.shift();\r\n        let shortcut_num = parseInt(shortcut_key);\r\n        let shortcut_cmd;\r\n        if (!isNaN(shortcut_num))\r\n            shortcut_cmd = _.client_options.shortcuts[shortcut_num];\r\n        else if (typeof (_.shortcuts_map[shortcut_key]) != 'undefined')\r\n            shortcut_cmd = _.client_options.shortcuts[_.shortcuts_map[shortcut_key]];\r\n\r\n        // Check if the shortcut is defined\r\n        if (shortcut_cmd) {\r\n            // Use the shortcut text as command\r\n            input = shortcut_cmd.cmd;\r\n\r\n            if (/\\$\\d+/.test(input)) {\r\n                // Substitute the arguments\r\n                for (let arg = 0; arg < args.length; ++arg) {\r\n                    let rx = new RegExp(\"\\\\$\" + (arg + 1), 'g');\r\n                    input = input.replace(rx, args[arg]);\r\n                }\r\n\r\n                // Remove remaining variables\r\n                input = input.replace(/\\$\\d+/g, '');\r\n            } else\r\n                input += \" \" + args.join(\" \");\r\n        }\r\n\r\n        if (_.cmd_prefix.length > 0)\r\n            input = _.cmd_prefix + \" \" + input;\r\n\r\n        return input;\r\n    }\r\n\r\n\r\n    /* *****************************************************************************\r\n     * COMMAND HISTORY\r\n     */\r\n\r\n    updateInput() {\r\n        let _ = this;\r\n        let text = _.cmd_history[_.cmd_history_pos] ? _.cmd_history[_.cmd_history_pos] : '';\r\n        $('#tgInputUser').val(text).focus();\r\n    }\r\n\r\n    historyUp() {\r\n        let _ = this;\r\n        if (_.cmd_history_pos > 0) {\r\n            _.cmd_history_pos--;\r\n            _.updateInput();\r\n        }\r\n    }\r\n\r\n    historyDown() {\r\n        let _ = this;\r\n        if (_.cmd_history_pos < _.cmd_history.length) {\r\n            _.cmd_history_pos++;\r\n            _.updateInput();\r\n        }\r\n    }\r\n\r\n    historyPush(text) {\r\n        let _ = this;\r\n        if (text.length > 0) {\r\n            if (_.cmd_history.length >= _.max_history_length)\r\n                _.cmd_history.shift();\r\n\r\n            if (_.cmd_history.length == 0 || _.cmd_history[_.cmd_history.length - 1] != text)\r\n                _.cmd_history.push(text);\r\n\r\n            _.cmd_history_pos = _.cmd_history.length;\r\n        }\r\n\r\n        $('#tgInputUser').val('');\r\n\r\n        return text;\r\n    }\r\n\r\n    sendToServer(text) {\r\n        let _ = this;\r\n        if (!_.isConnected) {\r\n            return;\r\n        }\r\n\r\n        _.socket.emit('data', text);\r\n    }\r\n\r\n    getLoginReplyMessage(what) {\r\n        let login_reply_message = {\r\n            'serverdown': 'Il server di gioco è momentaneamente spento. Riprova più tardi.',\r\n            'errorproto': 'Errore di comunicazione con il server.',\r\n            'errornonew': 'In questo momento non è permessa la creazione di nuovi personaggi.',\r\n            'invalidname': 'Nome non valido.',\r\n            'invalidpass': 'Password non valida.',\r\n            'loginerror': 'Personaggio inesistente o password errata.',\r\n            'staffonly': 'In questo momento solo lo staff può collegarsi, riprova più tardi.',\r\n            'plrreaderror': 'Errore di lettura del personaggio.',\r\n            'plrdisabled': 'Il personaggio è stato disattivato.',\r\n            'bannedip': 'Connessione da un indirizzo bloccato.',\r\n            'maxclients': 'Il server ha raggiunto il massimo numero di connessioni, riprova più tardi.',\r\n            'errorcoderequired': 'Per creare un altro personaggio ti serve un codice di attivazione.',\r\n            'errorinvalidcode': 'Il codice di invito inserito non è valido. Verifica di averlo digitato correttamente.',\r\n            'dupname': 'Esiste già un personaggio con questo nome. Per favore scegli un nome diverso.',\r\n            'invalidemail': 'L\\'indirizzo di email inserito non è valido.'\r\n        };\r\n\r\n        return login_reply_message[what];\r\n    }\r\n\r\n    showOutput(text) {\r\n\r\n        $('#output').append(text);\r\n\r\n        let outputHeigt = $('#output').height();\r\n        $('#scrollableOutput').scrollTop(outputHeigt);\r\n    }\r\n\r\n    clearOutput() {\r\n        $('#output').empty();\r\n    }\r\n\r\n    //check status of interface Data after first login.\r\n    interfaceUpdateStatus() {\r\n        let _ = this;\r\n        if (_.client_update.interfaceData.info && _.client_update.interfaceData.stato) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    loadInterface() {\r\n\r\n        let _ = this;\r\n\r\n        $('.tg-main').addClass('d-flex');\r\n\r\n        /* Interface Modules List */\r\n        _.genericEvents();\r\n        _.mainNavBarInit();\r\n        _.tooltipInit();\r\n        _.inputInit();\r\n        _.outputInit();\r\n        _.keyboardMapInit();\r\n        _.focusInput();\r\n        _.mapInit();\r\n        _.doorsInit();\r\n        _.buttonsEventInit();\r\n        _.main();\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     * MAIN NAVBAR\r\n     * -------------------------------------------------*/\r\n\r\n    mainNavBarInit() {\r\n        let _ = this;\r\n        /* Search Widget form */\r\n        _.initSearchWidget();\r\n    }\r\n\r\n    initSearchWidget() {\r\n\r\n        let options = {\r\n            url: \"ajax/cmd_list_guide.json\",\r\n            getValue: \"name\",\r\n            list: {\t\r\n              match: {\r\n                enabled: true,\r\n                onClickEvent: function(element) {\r\n                    alert(\"Non è stata inserita alcuna guida per \" + element.name);\r\n                }\r\n              }\r\n            },\r\n            theme: \"square\"\r\n          };\r\n\r\n        $('#tgSearchInput').easyAutocomplete(options);\r\n          \r\n        $('#tgSearchHelp').on('submit', function(e){\r\n            e.preventDefault();\r\n            _.openPopup('nofeature');\r\n        });\r\n    }\r\n\r\n\r\n    /* -------------------------------------------------\r\n     * TOOLTIP\r\n     * -------------------------------------------------*/\r\n\r\n    tooltipInit() {\r\n        $('body').tooltip({\r\n            selector: '[rel=\"tooltip\"]',\r\n            html: true,\r\n            delay: {'show': 500, 'hide': 0}\r\n        });\r\n    }\r\n\r\n     /* -------------------------------------------------\r\n     * INPUT\r\n     * -------------------------------------------------*/\r\n\r\n    inputInit() {\r\n        let _ = this;\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     * OUTPUT\r\n     * -------------------------------------------------*/\r\n\r\n    outputInit() {\r\n        let selector = '#scrollableOutput'\r\n        this.addScrollBar(selector);\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     * KEYBOARD MAP\r\n     * -------------------------------------------------*/\r\n\r\n    keyboardMapInit() {\r\n\r\n        let _ = this;\r\n\r\n        if (!_.isConnected) {\r\n            return true;\r\n        }\r\n\r\n        $('#tgMap').mouseenter(function () {\r\n            _.cursor_on_map = true;\r\n        });\r\n\r\n        $('#tgMap').mouseleave(function () {\r\n            _.cursor_on_map = false;\r\n        });\r\n\r\n\r\n        $(document).on('keydown', function (event) {\r\n\r\n            // if is not connected?\r\n            if (!_.isConnected, _.in_editor) {\r\n                return true;\r\n            };\r\n\r\n            if (event.metaKey || event.ctrlKey) {\r\n                return true;\r\n            }\r\n\r\n            /* Stop event Listener if we are inside Modal  */\r\n            if (_.in_editor) {\r\n                return true;\r\n            }\r\n            if (event.altKey || _.cursor_on_map) {\r\n\r\n                switch (event.which) {\r\n                    case 33:\r\n                        _.goDir(_.dir_up);\r\n                        return false;\r\n                    case 34:\r\n                        _.goDir(_.dir_down);\r\n                        return false;\r\n\r\n                    case 37:\r\n                        _.goDir(_.dir_west);\r\n                        return false;\r\n\r\n                    case 38:\r\n                        _.goDir(_.dir_north);\r\n                        return false;\r\n\r\n                    case 39:\r\n                        _.goDir(_.dir_east);\r\n                        return false;\r\n\r\n                    case 40:\r\n                        _.goDir(_.dir_south);\r\n                        return false;\r\n                }\r\n            }\r\n            if ($(event.target).is('#tgInputUser') === true) {\r\n                /* ENTER key, handle here */\r\n                if (event.which == 13) {\r\n                    _.sendInput();\r\n                    return false;\r\n                }\r\n\r\n                /* \"!\" alias  to send last command */\r\n                if (event.which == 49 && event.shiftKey === true && $(event.target).val().length == 0) {\r\n                    let l = _.cmd_history.length;\r\n\r\n                    if (l > 0)\r\n                        _.processCommands(_.cmd_history[l - 1]);\r\n                    return false;\r\n                }\r\n\r\n                /* Enter Key */\r\n                switch (event.which) {\r\n                    case 13:\r\n                        _.sendInput();\r\n                        return true;\r\n                        //Arrow UP\r\n                    case 38:\r\n                        _.historyUp();\r\n                        event.preventDefault();\r\n                        return true;\r\n                        //Arrow DOWN\r\n                    case 40:\r\n                        _.historyDown();\r\n                        event.preventDefault();\r\n                        return true;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     *  MAP \r\n     * -------------------------------------------------*/\r\n\r\n    mapInit() {\r\n        let _ = this;\r\n        _.MAP_OBJECT = new Map();\r\n        _.MAP_OBJECT.init();\r\n        _.MAP_OBJECT.prepareCanvas(_.images_path);\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     *  DOORS \r\n     * -------------------------------------------------*/\r\n\r\n    doorsInit() {\r\n        let _ = this;\r\n        for (let d = 0; d < _.dir_names.length; ++d)\r\n            $('#' + _.dir_names[d]).on('click', {\r\n                dir: d\r\n            }, function (event) {\r\n\r\n                if (_.inGame) {\r\n                    if (event.which == 1) {\r\n                        _.goDir(event.data.dir);\r\n                    } else if (event.which == 3) {\r\n                        event.preventDefault();\r\n                        _.closeLockDoor(event.data.dir);\r\n                    }\r\n                }\r\n            });\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     *  Buttons Events\r\n     * -------------------------------------------------*/\r\n\r\n    buttonsEventInit() {\r\n        let _ = this;\r\n        \r\n        /* Buttons with CMD event */\r\n        let cmdButtons = [\r\n            {id:'#userDisconnect', cmd : function () {\r\n                disconnectFromServer();\r\n            } }\r\n        ]\r\n\r\n        $.each(cmdButtons, function(idx, bdata) {\r\n            let button = $(bdata.id);\r\n\r\n            if(bdata.cmd) {\r\n                button.on('click', \r\n                typeof bdata.cmd == 'function' ? bdata.cmd  : function() {\r\n                    if(_.inGame) {\r\n                        _.processCommands(bdata.cmd)\r\n                    }\r\n                    if(bdata.text) {\r\n                        //TODO open modal by reference\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        /* Toggle character panel  Display */\r\n        $('#triggerToggleCharacterPanel').on('click', function () {\r\n\r\n            if (_.client_options.interface.dashboard == 0) {\r\n\r\n                $('.tg-dashboard').addClass('midopen');\r\n                _.client_options.interface.dashboard = 1;\r\n\r\n                return;\r\n            }\r\n\r\n            if (_.client_options.interface.dashboard == 1 || _.client_options.interface.dashboard == 2) {\r\n                _.client_options.interface.dashboard = _.client_options.interface.dashboard == 1 ? 2 : 0;\r\n\r\n                $('.tg-characterpanel').slideToggle(300, function () {\r\n                    let outputHeigt = $('#output').height();\r\n                    $('#scrollableOutput').animate({\r\n                        scrollTop: outputHeigt\r\n                    }, 500, 'linear');\r\n                    $('.tg-dashboard').removeClass('midopen');\r\n                });\r\n            }\r\n        });\r\n\r\n        //Expand tg-area\r\n        $('#triggerExpandTgArea').on('click', function () {\r\n            $('.tg-area').toggleClass('expanded', function () {});\r\n            setTimeout(() => {\r\n                let outputHeigt = $('#output').height();\r\n                $('#scrollableOutput').animate({\r\n                    scrollTop: outputHeigt\r\n                }, 500, 'linear');\r\n            }, 200);\r\n        })\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     *  Generic Events\r\n     * -------------------------------------------------*/\r\n    genericEvents() {\r\n        let _ = this;\r\n        $('.no-feature').on('click', function (e) {\r\n            e.preventDefault();\r\n            _.openPopup('nofeature');\r\n        });\r\n\r\n    }\r\n\r\n    sendInput() {\r\n        let inputVal = $('#tgInputUser').val();\r\n        this.processCommands(inputVal, true);\r\n    }\r\n\r\n    focusInput() {\r\n        $('#tgInputUser').focus();\r\n    }\r\n\r\n    /* -------------------------------------------------\r\n     *  POPUP\r\n     * -------------------------------------------------*/\r\n    openPopup(content_ref, title, content) {\r\n\r\n        let _ = this;\r\n\r\n        let MP_type = 'inline',\r\n            MP_close_button = false,\r\n            MP_closeOnBgClick = false,\r\n            MP_src = content,\r\n            MP_callbacks = {};\r\n\r\n        switch (content_ref) {\r\n            /* Cookie Law */\r\n            case 'cookielaw':\r\n                MP_type = 'ajax';\r\n                MP_src = './ajax/cookielawAlert.html';\r\n                break;\r\n\r\n            /* ALPHA Client Version ALERT */\r\n            case 'alpha_version':\r\n                if (_.client_options.alpha_approved) {\r\n                    return;\r\n                }\r\n                MP_src = 'ajax/alphaModalAlert.html';\r\n                MP_type = 'ajax';\r\n                break;\r\n            case 'nofeature':\r\n                MP_type = 'inline';\r\n                MP_closeOnBgClick = true;\r\n                MP_close_button = true;\r\n                MP_src = '<div class=\"tg-modal\">Funzionalità non ancora implementata</div>';\r\n                break;\r\n\r\n            case 'notizie':\r\n                MP_close_button = true;\r\n                MP_src = '<div class=\"tg-modal\">zona notizie</div>';\r\n                MP_callbacks.close = function () {\r\n                    _.sendInput();\r\n                };\r\n                break;\r\n\r\n            case 'editor':\r\n                MP_src = '#editorDialog';\r\n                MP_close_button = true,\r\n                    MP_callbacks.open = function () {\r\n                        $('.mfp-close').on('click', function (event) {\r\n                            event.preventDefault();\r\n                            _.abortEdit();\r\n                            $.magnificPopup.close();\r\n                        });\r\n                    }\r\n                MP_callbacks.close = function (e) {\r\n                    _.closeEditor();\r\n                };\r\n                break;\r\n\r\n            default:\r\n                //TODO: make default value to avoid error.\r\n\r\n                break;\r\n        }\r\n\r\n        // Open Modal / Popup\r\n        $.magnificPopup.open({\r\n            showCloseBtn: MP_close_button,\r\n            closeOnBgClick: MP_closeOnBgClick,\r\n            type: MP_type,\r\n            preloader: false,\r\n            items: {\r\n                src: MP_src,\r\n                type: MP_type\r\n            },\r\n            mainClass: 'modal-' + content_ref,\r\n            callbacks: MP_callbacks\r\n        });\r\n        //add Draggable\r\n        $($.magnificPopup.instance.contentContainer).draggabilly({\r\n            handle: '.tg-modal-title',\r\n            containment: '.tg-area'\r\n        });\r\n\r\n        return $.magnificPopup.instance;\r\n    }\r\n\r\n\r\n    addScrollBar(container) {\r\n        this.scrollbar.output = new PerfectScrollbar(container, {\r\n            wheelPropagation: 2,\r\n        });\r\n    }\r\n\r\n\r\n    // UTILITY\r\n    isModalOpen() {\r\n        return $.magnificPopup.instance.isOpen;\r\n    }\r\n\r\n    main() {}\r\n}","export default class MapDrawer {\r\n\r\n    constructor() {\r\n\r\n        this.container = '#tgMap';\r\n        this.maxmapwidth = 9;\r\n        this.maxmapheight = 9;\r\n        this.maptilewidth = 32;\r\n        this.maptileheight = 32;\r\n        this.maplight;\r\n        this.mapidprefix = 'mp'\r\n        this.MAPCTX = null;\r\n        this.maptileimg = null;\r\n        this.mapshadowimg = [];\r\n        this.MAPRAIN = null;\r\n        this.MAPSNOW = null;\r\n        this.mapfogimg = null;\r\n        this.cursoronmap = false;\r\n        // this.mapsizedata = {\r\n        //     'map_n':{ dialogClass:null, width: 360, height: 375 },\r\n        //     'map_m':{ dialogClass:'small', width: 287, height: 295 },\r\n        //     'map_s':{ dialogClass:'tiny', width: 216, height: 225 }\r\n        // };\r\n\r\n        this.layermap = null;\r\n    }\r\n\r\n    init() {\r\n        let _ = this;\r\n\r\n        _.layermap = new Array(_.maxmapheight);\r\n\r\n        for (let y = 0; y < _.maxmapheight; ++y) {\r\n            _.layermap[y] = new Array(_.maxmapwidth);\r\n        }\r\n\r\n    }\r\n\r\n    prepareCanvas(imagesPath) {\r\n        let _ = this;\r\n\r\n\r\n        $(_.container).append('<canvas id=\"mapcont\" width=\"' + (_.maxmapwidth * _.maptilewidth) + '\" height=\"' + (_.maxmapheight * _.maptileheight) + '\"></canvas>');\r\n\r\n        _.MAPCTX = $('#mapcont')[0].getContext('2d');\r\n\r\n        //Base Tiles\r\n        _.maptileimg = new Image();\r\n        _.maptileimg.src = imagesPath + '/tiles/tiles.png';\r\n\r\n        // // Fog\r\n        // _.mapfogimg = new Image();\r\n        // _.mapfogimg.src = \"<%= image_url_from_assets_file('interface/map/fog.png') %>\";\r\n\r\n        // // Rain\r\n        //_.makeRain();\r\n        // Snow\r\n        _.makeSnow();\r\n        // Shadows\r\n        _.mapshadowimg[2] = new Image();\r\n        _.mapshadowimg[2].src = imagesPath + '/interface/shadow1.png';\r\n\r\n        _.mapshadowimg[1] = new Image();\r\n        _.mapshadowimg[1].src = imagesPath + '/interface/shadow2.png';\r\n\r\n        _.mapshadowimg[0] = new Image();\r\n        _.mapshadowimg[0].src = imagesPath + '/interface/shadow3.png';\r\n\r\n        _.mapshadowtile = new Image();\r\n        _.mapshadowtile.src = imagesPath + '/interface/shadowtile.png';\r\n    }\r\n\r\n    updateMap(map) {\r\n        this.drawCanvasMap(map);\r\n    }\r\n\r\n    drawCanvasMap(map) {\r\n        let _ = this;\r\n        let xoff, yoff, xlim, ylim, light, canvaswidth, canvasheight;\r\n        //clip options\r\n        let radius = 75;\r\n        let offset = 0;\r\n\r\n        xoff = (_.maxmapwidth - map.d) / 2;\r\n        yoff = (_.maxmapheight - map.d) / 2;\r\n        xlim = xoff + map.d;\r\n        ylim = yoff + map.d;\r\n\r\n        canvaswidth = _.maxmapwidth * _.maptilewidth;\r\n        canvasheight = _.maxmapheight * _.maptileheight;\r\n\r\n        /* Clear the canvas*/\r\n        _.MAPCTX.clearRect(0, 0, canvaswidth, canvasheight);\r\n\r\n        /* Cycle on the 2 layers */\r\n        for (let l = 0; l < 2; l++) {\r\n            let pos = 0;\r\n            for (let y = 0; y < _.maxmapwidth; y++) {\r\n                for (let x = 0; x < _.maxmapheight; x++) {\r\n                    if (x >= xoff && x < xlim && y >= yoff && y < ylim)\r\n                        _.layermap[y][x] = map.data[l][pos++];\r\n                    else {\r\n                        _.layermap[y][x] = 59;\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let y = 0; y < _.maxmapwidth; y++) {\r\n                for (let x = 0; x < _.maxmapheight; x++) {\r\n                    let d = _.layermap[y][x];\r\n                    if (d != 59) {\r\n                        let tpos = _.tileCoords(d);\r\n                        //Draw image before Clip\r\n                        //_.MAPCTX.save();\r\n                        //_.MAPCTX.beginPath();\r\n                        // _.MAPCTX.arc(canvaswidth / 2, canvasheight / 2, canvaswidth, 0, 2 * Math.PI, false);\r\n                        // _.MAPCTX.clip();\r\n                        _.MAPCTX.drawImage(_.maptileimg, tpos[0], tpos[1], _.maptilewidth, _.maptilewidth, x * _.maptilewidth, y * _.maptileheight, _.maptilewidth, _.maptileheight);\r\n\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (l == 0) {\r\n                for (let y = 0; y < _.maxmapwidth; y++) {\r\n                    for (let x = 0; x < _.maxmapheight; x++) {\r\n                        if (_.layermap[y][x] == 59) {\r\n                            let clipx = 0,\r\n                                clipy = 0,\r\n                                swidth = 48,\r\n                                sheight = 48;\r\n\r\n                            if (y == 0 || _.layermap[y - 1][x] == 59) {\r\n                                clipy = 8;\r\n                                sheight -= 8;\r\n                            }\r\n\r\n                            if (y == (_.maxmapheight - 1) || _.layermap[y + 1][x] == 59) {\r\n                                sheight -= 8;\r\n                            }\r\n\r\n                            if (x == 0 || _.layermap[y][x - 1] == 59) {\r\n                                clipx = 8;\r\n                                swidth -= 8;\r\n                            }\r\n\r\n                            if (x == (_.maxmapwidth - 1) || _.layermap[y][x + 1] == 59) {\r\n                                swidth -= 8;\r\n                            }\r\n                            _.MAPCTX.drawImage(_.mapshadowtile, clipx, clipy, swidth, sheight, x * _.maptilewidth - 8 + clipx, y * _.maptileheight - 8 + clipy, swidth, sheight);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (_.mapshadowimg[map.l]) {\r\n            _.MAPCTX.drawImage(_.mapshadowimg[map.l], 96 - 32 * map.l, 96 - 32 * map.l);\r\n        }\r\n\r\n        // if(map.f) {\r\n        //     _.MAPCTX.drawImage(mapfogimg, 0, 0);\r\n        // }\r\n\r\n        if (map.r) {\r\n            $('#rainCanvas').show();\r\n        } else {\r\n            $('#rainCanvas').hide();\r\n        }\r\n\r\n        if (map.s) {\r\n            $('#snowCanvas').show();\r\n        } else {\r\n            $('#snowCanvas').hide();\r\n        }\r\n    }\r\n\r\n    tileCoords(tilenum) {\r\n        let posx = 32 * (tilenum & 0x7f);\r\n        let posy = 32 * (tilenum >> 7);\r\n        return [posx, posy];\r\n    }\r\n\r\n\r\n    makeSnow() {\r\n\r\n        /* --- config start --- */\r\n\r\n        let snowCanvasId = \"snowCanvas\", // id of the canvas to use\r\n            framerate = 40, // which fps rate to use, this is not followed exactly\r\n            flakeNumberModifier = 1.0, // change this to change the number of flakes\r\n            fallSpeedModifier = 0.5; // falling speed\r\n\r\n        /* ---- config end ---- */\r\n\r\n        let canvas = document.getElementById(snowCanvasId),\r\n            context = canvas.getContext(\"2d\"),\r\n            width = canvas.width,\r\n            height = canvas.height,\r\n            numFlakes = Math.min(width, 300) * height / 400 * flakeNumberModifier,\r\n            flakes = [],\r\n            TWO_PI = Math.PI * 2,\r\n            radHeight = 40;\r\n        let flake = document.createElement(\"CANVAS\"),\r\n            flakeContext = flake.getContext(\"2d\");\r\n\r\n        // create flake grafic\r\n        flake.width = 8;\r\n        flake.height = 8;\r\n        flakeContext.fillStyle = \"#fff\";\r\n        flakeContext.beginPath();\r\n        flakeContext.arc(4, 4, 4, 0, TWO_PI);\r\n        flakeContext.fill();\r\n\r\n        // init snowflakes\r\n        for (let x = 0; x < numFlakes; x++) {\r\n            flakes[x] = getRandomFlake(true);\r\n        }\r\n\r\n        // start tick at specified fps\r\n        window.setInterval(tick, Math.floor(1000 / framerate));\r\n\r\n        // main routine\r\n        function tick() {\r\n            let posX = 0,\r\n                imageData;\r\n\r\n            // reset canvas for next frame\r\n            context.clearRect(0, 0, width, height);\r\n\r\n            for (let x = 0; x < numFlakes; x++) {\r\n                // calculate changes to snowflake\r\n                posX = flakes[x].x + Math.sin(flakes[x].yMod + flakes[x].y / radHeight * (5 - flakes[x].size)) * flakes[x].waveSize * (1 - flakes[x].size);\r\n                flakes[x].y += flakes[x].size * fallSpeedModifier; // bigger flakes are nearer to screen, thus they fall faster to create 3d effect\r\n\r\n                // if snowflake is out of bounds, reset\r\n                if (flakes[x].y > height + 5) {\r\n                    flakes[x] = getRandomFlake();\r\n                }\r\n\r\n                // draw snowflake\r\n                context.globalAlpha = (flakes[x].size - 1) / 3;\r\n                context.drawImage(flake, posX, flakes[x].y, flakes[x].size, flakes[x].size);\r\n            }\r\n\r\n            // repeat 300px wide strip with snowflakes to fill whole canvas\r\n            if (width > 300) {\r\n                context.globalAlpha = 1;\r\n                context.drawImage(canvas, 300, 0);\r\n                if (width > 600) context.drawImage(canvas, 600, 0);\r\n                if (width > 1200) context.drawImage(canvas, 1200, 0);\r\n                if (width > 2400) context.drawImage(canvas, 2400, 0);\r\n            }\r\n        }\r\n\r\n        // randomize flake data\r\n        function getRandomFlake(init) {\r\n            return {\r\n                x: range(10, 310),\r\n                y: init ? range(-5, height + 5) : -5,\r\n                size: Math.max(range(1, 4), 2),\r\n                yMod: range(0, 150),\r\n                waveSize: range(1, 4)\r\n            };\r\n        }\r\n\r\n        // get a random number inside a range\r\n        function range(start, end) {\r\n            return Math.random() * (end - start) + start;\r\n        }\r\n    }\r\n\r\n    makeRain() {\r\n        let _ = this;\r\n        _.MAPRAIN = $('#rainCanvas')[0];\r\n        let w = $('#rainCanvas').innerWidth();\r\n        let h = $('#rainCanvas').innerHeight();\r\n        console.log(_.MAPRAIN.getContext);\r\n            _.MAPRAIN =  _.MAPRAIN.getContext('2d');\r\n            _.MAPRAIN.strokeStyle = 'rgba(174,194,224,0.5)';\r\n            _.MAPRAIN.lineWidth = 1;\r\n            _.MAPRAIN.lineCap = 'round';\r\n\r\n\r\n            let init = [];\r\n            let maxParts = 1000;\r\n            for (let a = 0; a < maxParts; a++) {\r\n                init.push({\r\n                    x: Math.random() * w,\r\n                    y: Math.random() * h,\r\n                    l: Math.random() * 1,\r\n                    xs: -4 + Math.random() * 4 + 2,\r\n                    ys: Math.random() * 10 + 10\r\n                })\r\n            }\r\n\r\n            let particles = [];\r\n            for (let b = 0; b < maxParts; b++) {\r\n                particles[b] = init[b];\r\n            }\r\n\r\n            function draw() {\r\n                _.MAPRAIN.clearRect(0, 0, w, h);\r\n                for (let c = 0; c < particles.length; c++) {\r\n                    let p = particles[c];\r\n                    _.MAPRAIN.beginPath();\r\n                    _.MAPRAIN.moveTo(p.x, p.y);\r\n                    _.MAPRAIN.lineTo(p.x + p.l * p.xs, p.y + p.l * p.ys);\r\n                    _.MAPRAIN.stroke();\r\n                }\r\n                move();\r\n            }\r\n\r\n            function move() {\r\n                for (let b = 0; b < particles.length; b++) {\r\n                    let p = particles[b];\r\n                    p.x += p.xs;\r\n                    p.y += p.ys;\r\n                    if (p.x > w || p.y > h) {\r\n                        p.x = Math.random() * w;\r\n                        p.y = -20;\r\n                    }\r\n                }\r\n            }\r\n            setInterval(draw, 30);\r\n    }\r\n}","export default class Preloader {\r\n    constructor(assets, basepath) {\r\n        this.basepath = basepath;\r\n        this.assetsList = assets;\r\n    }\r\n\r\n    init() {\r\n        let _ = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_.assetsList) {\r\n                reject('TG Error: Assets List mancante');\r\n            }\r\n\r\n            $('body').attr('data-loginstatus', 'preload');\r\n\r\n            _.loadAssets().done(function (images) {\r\n                // All Images loaded\r\n                $(document.body).attr('data-loginstatus', 'ready');\r\n                $('#tgPreloader').remove();\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    loadAssets() {\r\n        let _ = this;\r\n        let percentage = 0;\r\n        let stepSize = 100 / _.assetsList.length;\r\n\r\n\r\n        let images = [],\r\n            loadedimages = 0,\r\n            postaction = function () {},\r\n            assets = (typeof _.assetsList != \"object\") ? [_.assetsList] : _.assetsList;\r\n\r\n\r\n        function imageloadpost() {\r\n\r\n            percentage = Math.floor(percentage + stepSize);\r\n            if (loadedimages == assets.length - 1) {\r\n                percentage = 100;\r\n            }\r\n            $('#tgPreloader').find('span').text(percentage);\r\n            $('.pbar').css('width', percentage + '%');\r\n\r\n            loadedimages++;\r\n\r\n            if (loadedimages == assets.length) {\r\n                postaction(images) //call postaction and pass in newimages array as parameter\r\n            }\r\n            $('#tgPreloader').find('span').text(percentage);\r\n        }\r\n\r\n        for (let i = 0; i < assets.length; i++) {\r\n            images[i] = new Image();\r\n            images[i].src = _.basepath + assets[i];\r\n            images[i].onload = function () {\r\n                imageloadpost();\r\n            }\r\n            images[i].onerror = function () {\r\n                imageloadpost();\r\n            }\r\n        }\r\n\r\n        return { //return blank object with done() method\r\n            done: function (f) {\r\n                postaction = f || postaction //remember user defined callback functions to be called when images load\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /* Complete list of fun random phrases that will be shown during the preload */\r\n    // randomizeFunnyText(count) {\r\n    //     let phrases = [\r\n    //         'Prima Frase',\r\n    //         '2 Frase',\r\n    //         '3 Frase',\r\n    //         '4 Frase',\r\n    //         '5 Frase',\r\n    //         '6 Frase',\r\n    //         '7 Frase',\r\n    //         '8 Frase'\r\n    //     ];\r\n\r\n    //     let m = phrases.length, \r\n    //         t, i;\r\n    //     // While there remain elements to shuffle…\r\n    //     while (m) {\r\n    //         // Pick a remaining element\r\n    //         i = Math.floor(Math.random() * m--);\r\n    //         // And swap it with the current element.\r\n    //         t = array[m];\r\n    //         phrases[m] = phrases[i];\r\n    //         phrases[i] = t;\r\n    //     }\r\n\r\n    //     let candidatePhrases = phrases.slice.slice(0, 4);\r\n    //     console.log(candidatePhrases);\r\n    // }\r\n}","/* (ignored) */","module.exports = __WEBPACK_EXTERNAL_MODULE_jquery__;"],"sourceRoot":""}