<form [formGroup]="frmStepFour">
  <div class="tg-registration-step" fxLayout>

    <div class="tg-sidebar" fxFlex="1 1 30%">
      <div class="tg-sidebar-text">

        <ng-container *ngIf="!attributeHover; else attrDescText">
          <!-- Attribute Description & Help -->
          <p>Il tuo personaggio ha diverse caratteristiche che ne descrivono le qualità
            fisiche e mentali. Esse dipendono in parte dalla sua razza, ma possono cambiare da individuo a
            individio.<br>
            Usa i <span class="tg-yellow">punti creazione</span> disponibili per modificare le caratteristiche
            del tuo personaggio <b>rispetto alla media della sua razza</b>. Se abbassi
            una caratteristica riceverai dei punti che potrai spendere per alzarne
            altre. Alzare una caratteristica ti costerà invece punti.
          </p>
        </ng-container>
        
        <ng-template #attrDescText>
          <p [innerHtml]="attributeDesc" *ngIf="attributeHover"></p>
        </ng-template>

      </div>
    </div>

    <div class="tg-detail-content" fxFlex="1 1 70%">
      <div class="tg-detail-text">

        <p class="attr-points">Punti creazione disponibili: <span class="attr-points">{{points}}</span></p>
        <mat-error *ngIf="hasError">Hai usato troppi punti rispetto al totale.</mat-error>

        <div class="tg-attribute-wrap">
          <table class="tg-attribute-table">
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Forza', ref: 'strength'}">
            </ng-container>
            <ng-container
              *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Costituzione', ref:'constitution'}">
            </ng-container>
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Taglia', ref:'size'}">
            </ng-container>
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Destrezza', ref:'dexterity'}">
            </ng-container>
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Velocità', ref:'speed'}">
            </ng-container>
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Empatia', ref:'empathy'}">
            </ng-container>
            <ng-container
              *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Intelligenza', ref:'intelligence'}">
            </ng-container>
            <ng-container *ngTemplateOutlet="attrSlider;context:{$implicit: 50, name:'Volontà', ref:'willpower'}">
            </ng-container>
          </table>
          <div class="tg-detail-action">
            <button mat-raised-button matStepperPrevious class="tg-step-back" type="button">Indietro</button>&nbsp;
            <button mat-raised-button matStepperNext class="tg-step-next" (click)="verifyAttr()">Avanti</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template #attrSlider let-default let-name="name" let-ref="ref">
    <tr>
      <th>
        <h3>{{name}}</h3>&nbsp;
        <span class="help" (mouseover)="onAttribute($event, ref)" (mouseout)="onAttribute($event, null)">[ ? ]</span>
      </th>
      <td>
        <div class="tg-attribute-bar">
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -30}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -25}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -20}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -15}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -10}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= -5}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 0}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 5}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 10}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 15}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 20}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] >= 25}"></span>
          <span class="barsection" [ngClass]="{
            'fill': attributesList[ref] == 30}"></span>
        </div>
    </td>
      <td>
        <div class="points-action">
          <button  type="button" (click)="decreaseAttr($event, ref)" class="decrease-btn">-</button>
          <input matInput name="counter" type="number" [value]="frmStepFour.get(ref).value" [formControlName]="ref" readonly required class="point-value">
          <button  type="button" (click)="increaseAttr($event, ref)" class="increase-btn">+</button >
        </div>
      </td>
    </tr>
  </ng-template>

</form>
