<div class="tg-output tg-box b-ironlight" fxFlex="1 1 100%" [ngClass]="{'pause-scroll': pauseScroll}">
  <div class="tg-box" fxFlex="100" fxLayout="column">


    <div class="tg-output-main" #mainOutputArea *ngIf="$tgConfig | async as tgConfig">
      <ng-container *ngIf="showExtraByViewport && tgConfig.output.extraArea.visible as extra; else noextra">

        <as-split class="tg-output--splitter"  
          [gutterSize]="11" 
          [direction]="'horizontal'"
          (dragEnd)="onDragEnd($event, 'output')" 
          (dragStart)="onDragStart()"
          #splitArea>

          <!--  Main Output Area -->
          <as-split-area [size]="tgConfig.output.extraArea.size[0]" style="position:relative">

            <ng-container *ngIf="pauseScroll">
              <ng-container *ngTemplateOutlet="pauseScroll"></ng-container>
            </ng-container>

            <tg-status></tg-status>

            <div style="height: 100%; overflow:hidden;" class="o-container">
              
              <ng-scrollbar class="scrollbar-output" [ngClass]="{'disabled': draggingSplitArea}" #scrollBar  [disabled]="draggingSplitArea">
                <div class="tg-output--history">

                  <div *ngIf="!output.length" class="no-output-notice">
                    Scrivi qualcosa o semplicemente aspetta...
                  </div>

                  <ng-container *ngFor="let data of output">
                    <ng-container [ngSwitch]="data.type">
                      <tg-text *ngSwitchCase="'base'" [html]="data.content"></tg-text>
                      <tg-generic-page *ngSwitchCase="'genericPage'" [html]='data.content'></tg-generic-page>
                      
                      <ng-container *ngSwitchCase="'pause'">
                        <ng-container ngTemplateOutlet="pausePlaceholder">
                        </ng-container>
                      </ng-container>
                    </ng-container>

                  </ng-container>

                </div>
                <div id="scrollerEnd" #scrollerEnd></div>
              </ng-scrollbar>
              
            </div>

          </as-split-area>

          <!-- Extra Output Area -->
          <as-split-area [size]="tgConfig.output.extraArea.size[1]">
            <div style="height: 100%; overflow:hidden;" fxLayout="column">
              <as-split class="tg-output--splitter" 
                direction="vertical" 
                [gutterSize]="5" 
                [restrictMove]="true"
                unit="pixel" 
                (dragStart)="onDragStart()"
                (dragEnd)="onDragEnd($event, 'equipinv')">

                <as-split-area size="*">
                  <tg-room [html]="typeDetail ==='room' ? (lastRoom$ | async) : objPersDetail" 
                    [withExtra]="extra"
                    [lastDescription]="lastRoomDescription" 
                    [draggingSplitArea]="draggingSplitArea"
                    [type]="typeDetail"></tg-room>
                </as-split-area>

                <as-split-area 
                  [size]="tgConfig.equipInventoryBox.visible ? tgConfig.equipInventoryBox.size : tgConfig.equipInventoryBox.sizeWhenClose" 
                  [lockSize]="smartSizeArea === tgConfig.equipInventoryBox.sizeWhenClose">
                  <tg-smart-equip-inventory [draggingSplitArea]="draggingSplitArea"></tg-smart-equip-inventory>
                </as-split-area>

              </as-split>
            </div>
          </as-split-area>

        </as-split>

      </ng-container>
    </div>

  </div>
  <div class="tg-border-box">
    <div class="tg-border tg-border-top"></div>
    <div class="tg-border tg-border-left"></div>
    <div class="tg-border tg-border-right"></div>
    <div class="tg-border tg-border-bottom"></div>
  </div>
</div>

<ng-template #noextra>

  <ng-container *ngIf="pauseScroll">
    <ng-container *ngTemplateOutlet="pauseScroll"></ng-container>
  </ng-container>

  <tg-status></tg-status>

  <div style="height: 100%; overflow:hidden;">

    <ng-scrollbar class="scrollbar-output" #scrollBar>
      <div class="tg-output--history" >
        <div *ngFor="let data of outputObservable | async; let i = index">

          <ng-container [ngSwitch]="data.type">
            <tg-text *ngSwitchCase="'base'" [html]="data.content"></tg-text>
            <tg-room *ngSwitchCase="'room'" [withExtra]="false" [html]="data.content"
              [lastDescription]="lastRoomDescription"></tg-room>
            <tg-objpers-detail *ngSwitchCase="'objPersDetail'" [html]="data.content"></tg-objpers-detail>
            <tg-generic-page *ngSwitchCase="'genericPage'" [html]='data.content'></tg-generic-page>
            
            <ng-container *ngSwitchCase="'pause'">
              <ng-container ngTemplateOutlet="pausePlaceholder">
              </ng-container>
            </ng-container>

          </ng-container>

        </div>
      </div>
      <div #scrollerEnd class="scrollend" style="height: 100%; width: 100%; display:block;"></div>
    </ng-scrollbar>
  </div>
</ng-template>



<ng-template #pauseScrollBadge>
  <div class="tg-error alert-inline mat-elevation-z10" *ngIf="pauseScroll">
    Autoscroll disattivato - <button mat-button (click)="goToPausePlaceHolder()" style="text-decoration: underline; font-size: 1em;">Vai al segnaposto</button>
  </div>
</ng-template>


<ng-template #pausePlaceholder>
  <!-- Pause scroll Place Holder -->
  <div #pausePlaceholder class="placeholder-pause" fxLayout="row">SEGNAPOSTO</div>
</ng-template>

