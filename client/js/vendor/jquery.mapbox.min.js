!function(t,e,i){t.fn.mapbox=function(a,o){function l(e){if(!a.zoom)return!1;e=0===e?0:e||1;var i=t(this).find(">div"),o=i.length-1,l=t(this).find(".current-map-layer"),h=this.visible,s=h;h+=e/a.layerSplit,0>h&&(h=0),h>o&&(h=o),s=Math.ceil(h);var n=this.visible==h?!1:!0;this.visible=h,"function"==typeof a.beforeZoom&&a.beforeZoom(s,l[0],this.xPos,this.yPos,this);var r=l.width(),f=l.height(),c=(t(this).width()/2+this.xPos)/r,u=(t(this).height()/2+this.yPos)/f;if(a.layerSplit>1&&s>0)var d=h-(s-1),p=i.eq(s)[0].defaultWidth,y=i.eq(s)[0].defaultHeight,m=i.eq(s-1).width(),g=i.eq(s-1).height(),v=p-m,w=y-g,b=m+v*d,k=g+w*d;a.layerSplit>1&&s>0&&(i.eq(s).width(b).find(".map-layer-mask").width(b).height(k),i.eq(s).height(k).find(a.mapContent).width(b).height(k));var x=i.eq(s).width()*c-t(this).width()/2,C=i.eq(s).height()*u-t(this).height()/2;x=0-x,C=0-C;var q=t(this).width()-i.eq(s).width(),P=t(this).height()-i.eq(s).height();x>0&&(x=0),C>0&&(C=0),q>x&&(x=q),P>C&&(C=P),this.xPos=0-x,this.yPos=0-C,i.removeClass("current-map-layer").hide();var Z=i.eq(s).css({left:x+"px",top:C+"px",display:"block"}).addClass("current-map-layer");return"function"==typeof a.afterZoom&&a.afterZoom(s,i.eq(s)[0],this.xPos,this.yPos,this),Z[0]!==l[0]&&"function"==typeof a.afterLayerChange&&a.afterLayerChange(s,i.eq(s)[0],this.xPos,this.yPos,this),n}function h(e,i,a){a=a||t(this).find(".current-map-layer");var o=0,l=0,h=t(this).width(),s=t(this).height(),n=t(a).width(),r=t(a).height();n>h&&(o=h-n),r>s&&(l=s-r);var f=0-(this.xPos+e),c=0-(this.yPos+i);f=f>0?0:f,f=o>f?o:f,c=c>0?0:c,c=l>c?l:c,this.xPos=0-f,this.yPos=0-c,t(a).css({left:f+"px",top:c+"px"})}function s(e,i,a){a=a||t(this).find(".current-map-layer"),e=0-e,i=0-i;var o=0-(t(a).width()-t(this).width()),l=0-(t(a).height()-t(this).height());e>0&&(e=0),i>0&&(i=0),o>e&&(e=o),l>i&&(i=l),this.xPos=0-e,this.yPos=0-i,t(a).css({left:e+"px",top:i+"px"})}function n(t){return t=t.replace(/px/,""),t=0-t}"function"==typeof o&&(a.afterDragging=o);var r;"string"==typeof a&&(r=a),a=t.extend({},t.fn.mapbox.options,a),t(this).css({overflow:"hidden",position:"relative"});var f={zoom:function(t){t=t||1,l.call(this,t)},back:function(t){t=t||1,l.call(this,0-t)},left:function(t){t=t||10,h.call(this,0-t,0)},right:function(t){t=t||10,h.call(this,t,0)},up:function(t){t=t||10,h.call(this,0,0-t)},down:function(t){t=t||10,h.call(this,0,t)},center:function(e){e=e||{x:t(this).find(".current-map-layer").width()/2,y:t(this).find(".current-map-layer").height()/2};var i=t(this).find(".current-map-layer"),a=e.x-t(this).width()/2,o=e.y-t(this).height()/2;s.call(this,a,o,i[0])},zoomTo:function(t){var e=Math.round((t-this.visible)/(1/this.layerSplit));l.call(this,e)}};return this.each(function(){if("string"==typeof r){var h=f[r];a.layerSplit=this.layerSplit||a.layerSplit,h.call(this,o)}else{this.visible=a.defaultLayer,this.layerSplit=a.layerSplit;var c=this,u=t(this).find(">div"),d=t(this).height(),p=t(this).width(),y=!1,m=!0;u.css({position:"absolute"}).eq(a.defaultLayer).css({display:"block",left:"",top:""}).addClass("current-map-layer").find(a.mapContent).css({position:"absolute",left:"0",top:"0",height:d+"px",width:"100%"}),u.each(function(){this.defaultWidth=t(this).width(),this.defaultHeight=t(this).height(),t(this).find(a.mapContent).css({position:"absolute",top:"0",left:"0"}),t(this).find(a.mapContent).length>0&&t(this).find(">img").css({width:"100%",position:"absolute",left:"0",top:"0"}).after('<div class="map-layer-mask"></div>')}),t(this).find(".map-layer-mask").css({position:"absolute",left:"0",top:"0",background:"white",opacity:"0",filter:"alpha(opacity=0)"}),a.defaultLayer>0&&(u.eq(a.defaultLayer).find(".map-layer-mask").width(u.eq(a.defaultLayer).width()).height(u.eq(a.defaultLayer).height()),u.eq(a.defaultLayer).find(a.mapContent).width(u.eq(a.defaultLayer).width()).height(u.eq(a.defaultLayer).height())),t(this).find(">div:not(.current-map-layer)").hide(),null==a.defaultX&&(a.defaultX=Math.floor(p/2-t(this).find(".current-map-layer").width()/2),a.defaultX>0&&(a.defaultX=0)),null==a.defaultY&&(a.defaultY=Math.floor(d/2-t(this).find(".current-map-layer").height()/2),a.defaultY>0&&(a.defaultY=0)),this.xPos=0-a.defaultX,this.yPos=0-a.defaultY,this.layerSplit=a.layerSplit;var g,v,w=a.defaultX,b=a.defaultY;t(this).find(".current-map-layer").css({left:a.defaultX+"px",top:a.defaultY+"px"});var k=!1;t(this).mousedown(function(){var e=t(this).find(".current-map-layer"),i=e[0].style.left,o=e[0].style.top;return i=n(i),o=n(o),a.beforeDragging(e,i,o,c),y=!0,m=!0,!1}),t(i).mouseup(function(){var e=t(c).find(".current-map-layer"),i=e[0].style.left,o=e[0].style.top;return i=n(i),o=n(o),a.afterDragging(e,i,o,c),y=!1,k&&(C=!1),k=!1,!1}),t(i).mousemove(function(e){var i=t(c).find(".current-map-layer");if(y&&a.pan){m?(g=e.clientX,v=e.clientY,w=i[0].style.left.replace(/px/,""),b=i[0].style.top.replace(/px/,""),m=!1):k=!0;var o=0,l=0;p<i.width()&&(o=p-i.width()),d<i.height()&&(l=d-i.height());var h=w-(g-e.clientX);h=h>0?0:h,h=o>h?o:h;var s=b-(v-e.clientY);s=s>0?0:s,s=l>s?l:s,i.css({left:h+"px",top:s+"px"}),c.xPos=n(i[0].style.left),c.yPos=n(i[0].style.top)}}),a.mousewheel&&"undefined"!=typeof t.fn.mousewheel&&t(c).mousewheel(function(e,i){if(a.zoomToCursor)var o=t(this).find(".current-map-layer"),h=e.pageY-o.offset().top,n=e.pageX-o.offset().left,r=e.pageY-t(this).offset().top,f=e.pageX-t(this).offset().left,c=h/o.height(),u=n/o.width();if(l.call(this,i)&&a.zoomToCursor){o=t(this).find(".current-map-layer");var d=o.width()*u,p=o.height()*c;s.call(this,d-f,p-r,o[0])}return!1});var x=setTimeout(function(){},0),C=!0;(a.doubleClickZoom||a.doubleClickZoomOut||a.doubleClickMove)&&t(c).dblclick(function(e){clearTimeout(x),C=!1;var i=t(this).find(".current-map-layer"),o=e.pageY-i.offset().top,h=e.pageX-i.offset().left,s=o/i.height(),n=h/i.width();distance=a.doubleClickZoom?a.doubleClickDistance:a.doubleClickZoomOut?0-a.doubleClickDistance:0,l.call(this,distance),i=t(this).find(".current-map-layer");var r=i.width()*n,c=i.height()*s;return f.center.call(this,{x:r,y:c}),!1}),(a.clickZoom||a.clickZoomOut||a.clickMove)&&t(c).click(function(e){function i(){if(C){var i,o=t(this).find(".current-map-layer"),h=e.pageY-o.offset().top,s=e.pageX-o.offset().left,n=h/o.height(),r=s/o.width();i=a.clickZoom?a.clickDistance:a.clickZoomOut?0-a.clickDistance:0,l.call(this,i),o=t(this).find(".current-map-layer");var c=o.width()*r,u=o.height()*n;f.center.call(this,{x:c,y:u})}C=!0}a.doubleClickZoom||a.doubleClickZoomOut||a.doubleClickMove?x=setTimeout(function(){i.call(c)},400):i.call(this)}),t(e).load(function(){u.each(function(){var e=t(this).find("img")[0];"object"==typeof e&&t("<img>").attr("src",e.src)})})}})},t.fn.mapbox.options={zoom:!0,pan:!0,defaultLayer:0,layerSplit:4,mapContent:".mapcontent",defaultX:null,defaultY:null,zoomToCursor:!0,doubleClickZoom:!1,clickZoom:!1,doubleClickZoomOut:!1,clickZoomOut:!1,doubleClickMove:!1,clickMove:!1,doubleClickDistance:1,clickDistance:1,beforeDragging:function(){},afterDragging:function(){},beforeZoom:function(){},afterZoom:function(){},afterLayerChange:function(){},mousewheel:!1}}(jQuery,window,document);